<!doctype html>
<html lang="mr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>рдЖрдЬрдЪрдВ рдкрдВрдЪрд╛рдВрдЧ тАФ OmKarmyog (Final)</title>

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@700;800&family=Noto+Sans+Devanagari:wght@400;600;700&display=swap" rel="stylesheet">

  <!-- html2canvas -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

  <style>
    :root{
      --W:1080; --H:1729;
      --cream:#fffaf3;
      --saffron:#e56a2e;
      --gold:#d9a64b;
      --green:#0d7c31;
      --dark:#0b2b3a;
      --muted:#6d6d6d;
    }
    *{box-sizing:border-box;margin:0;padding:0}
    body{font-family:'Noto Sans Devanagari',sans-serif;background:linear-gradient(135deg,#1b5e20 0%,#2e7d32 100%);padding:18px;display:flex;justify-content:center;min-height:100vh;color:var(--dark)}
    .container{width:100%;max-width:1400px;margin:0 auto}
    .main{display:grid;grid-template-columns:1080px 380px;gap:20px;align-items:start}
    /* CARD */
    #panchangCard{width:1080px;height:1729px;background:var(--cream);border-radius:10px;overflow:hidden;box-shadow:0 24px 60px rgba(0,0,0,.35);position:relative}
    /* TOP */
    .top-bar{display:flex;align-items:center;justify-content:space-between;padding:18px 36px;border-bottom:6px solid var(--gold);background:linear-gradient(180deg,#fff 0%,#fbfbfb 100%)}
    .top-left{flex:1}
    .title{font-family:'Baloo 2';font-size:40px;font-weight:800;color:#111}
    .date {font-size:28px;font-weight:700;color:#d32f2f;margin-top:6px}
    .day {font-size:24px;font-weight:700;color:#d32f2f;margin-top:4px}
    .ganesh-center{width:260px;text-align:center}
    .ganesh-center img{width:220px;height:220px;object-fit:contain;filter:drop-shadow(0 8px 24px rgba(0,0,0,.35))}
    .logo-right{width:120px;height:80px;text-align:right}
    .logo-right img{max-width:100%;max-height:80px;object-fit:contain;filter:drop-shadow(0 4px 12px rgba(0,0,0,.2))}
    /* Shalivahan */
    .shalivahan{padding:18px 36px;text-align:center;background:linear-gradient(180deg,#c62828 0%,#b71c1c 100%);color:#fff;border-bottom:6px solid var(--gold)}
    .shalivahan h3{font-family:'Baloo 2';font-size:34px;margin-bottom:6px}
    .shalivahan p{font-size:18px;margin:0}
    /* Blue sunrise */
    .blue-row{padding:16px 36px;background:linear-gradient(135deg,#1565c0 0%,#0d47a1 100%);border-bottom:6px solid var(--gold)}
    .blue-inner{display:flex;justify-content:center;gap:26px;align-items:center}
    .sun-box{display:flex;align-items:center;gap:12px;background:rgba(255,255,255,0.08);padding:10px 18px;border-radius:36px;backdrop-filter:blur(6px)}
    .sun-icon{width:56px;height:56px;background:#fff;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:26px;box-shadow:0 4px 14px rgba(0,0,0,.18)}
    .sun-info h4{color:#fff;font-size:14px;margin:0}
    .sun-info .time{color:var(--gold);font-weight:800;font-size:24px}
    /* Table */
    .table-wrap{padding:20px 36px;background:linear-gradient(180deg,#fff8e1 0%,#ffffff 100%)}
    table{width:100%;border-collapse:collapse;border:4px solid #ff9800}
    th,td{padding:12px 10px;text-align:center;border:2px solid #ff9800}
    th{background:linear-gradient(135deg,#ffd700 0%,#ffb300 100%);color:#c62828;font-weight:900;font-size:16px}
    td{font-weight:700;font-size:18px}
    td.tithi{font-size:20px}
    td.time{color:#c62828}
    td.next{color:#6d6d6d;font-size:16px}
    /* Rashi boxes */
    .rashi-wrap{padding:18px 36px;background:#fff;display:grid;grid-template-columns:repeat(4,1fr);gap:14px}
    .rashi{background:#fff;border:3px solid #ff9800;border-radius:12px;padding:14px;text-align:center;box-shadow:0 4px 10px rgba(0,0,0,.06)}
    .rashi .icon{font-size:22px;margin-bottom:6px}
    .rashi .label{color:#666;font-size:14px}
    .rashi .val{color:#c62828;font-weight:900;font-size:18px}
    /* din vishesh */
    .din-box{margin:20px 36px;padding:16px;border-radius:12px;background:linear-gradient(180deg,#fff8e6 0%,#fff2d9 100%);border:2px solid #e2a92f;color:#0b2b3a;font-weight:700;text-align:center;font-size:18px}
    /* footer */
    .footer{padding:18px 36px;background:linear-gradient(180deg,#f5f5f5 0%,#ffffff 100%);border-top:6px solid var(--gold);display:flex;align-items:center;justify-content:space-between;gap:12px;min-height:140px}
    .footer-left{display:flex;flex-direction:column;gap:6px;flex:1}
    .name{font-family:'Baloo 2';font-size:28px;color:var(--gold);font-weight:800}
    .office{font-size:18px;color:#333;font-weight:700}
    .contact{font-size:18px;color:#333}
    .footer-photo{width:150px;height:150px;border-radius:8px;object-fit:cover;border:4px solid var(--gold);box-shadow:0 6px 18px rgba(0,0,0,.18)}
    /* side form */
    .side{background:#fff;border-radius:12px;padding:16px;box-shadow:0 14px 40px rgba(0,0,0,.28);position:sticky;top:18px}
    .side .form-header{background:linear-gradient(135deg,#1b5e20 0%,#2e7d32 100%);padding:12px;border-radius:8px;color:#fff;text-align:center;margin:-16px -16px 12px -16px}
    .form-group{margin-bottom:12px}
    .photo-preview{width:120px;height:120px;object-fit:cover;border-radius:8px;display:none;border:4px solid #2e7d32;margin:10px auto}
    .btn-download{width:100%;padding:12px;border-radius:8px;background:linear-gradient(135deg,#d32f2f 0%,#c62828 100%);color:#fff;border:0;font-weight:800;cursor:pointer}
    @media(max-width:1200px){.main{grid-template-columns:1fr}}
    @media(max-width:900px){#panchangCard{transform:scale(.78);transform-origin:top center}}
  </style>
</head>
<body>
  <div class="container">
    <div class="main">
      <!-- card -->
      <div id="panchangCard" role="region" aria-label="рдкрдВрдЪрд╛рдВрдЧ рдХрд╛рд░реНрдб">
        <!-- top -->
        <div class="top-bar">
          <div class="top-left">
            <div class="title">рдЖрдЬрдЪреЗ рдкрдВрдЪрд╛рдВрдЧ</div>
            <div class="date" id="topDate">--</div>
            <div class="day" id="topDay">--</div>
          </div>

          <div class="ganesh-center" aria-hidden="true">
            <img id="ganeshImg" src="https://raw.githubusercontent.com/sanketramdasi264-prog/panchang/main/pngtree-artistic-vinayaka-chavithi-celebrations-for-ganesh-chaturthi-bal-free-transparent-png-image_14089909.png" alt="Ganesh">
          </div>

          <div class="logo-right">
            <img id="logoImg" src="https://blogger.googleusercontent.com/img/a/AVvXsEghUXDnRLeFXsuapWEpRem_Mtzst5Ae9zlttWprP9nI7dQ_Rh41nkHP3PqCiHrZo1YKUiMvbHaPZC6VZEBCSvuAvzQOVF7MxUon4i3Hdko0qGWwyl4BQ44KeAe-6qQACSUB8k-3wdI6N2Bt-8xsQSQnHW-a2AMw9SwT0hK4b5Ej5zmN_anbnY1pX2TC9pwR=s500" alt="logo">
          </div>
        </div>

        <!-- shalivahan -->
        <div class="shalivahan">
          <h3 id="shalivahanLine">рд╢рд╛рд▓рд┐рд╡рд╛рд╣рди рд╢рдХреЗ резрепрекрен</h3>
          <p id="shalivahanMeta">рд╡рд┐рд╢реНрд╡рд╛рд╡рд╕реБрдирд╛рдорд╕рдВрд╡рддреНрд╕рд░, рджрдХреНрд╖рд┐рдгрд╛рдпрди, рд╢рд░рджрдЛрддреВ, рдХрд╛рд░реНрддрд┐рдХ рдорд╛рд╕, рдХреГрд╖реНрдг рдкрдХреНрд╖</p>
        </div>

        <!-- blue sunrise/sunset -->
        <div class="blue-row">
          <div class="blue-inner">
            <div class="sun-box">
              <div class="sun-icon">ЁЯМЕ</div>
              <div class="sun-info">
                <h4>рд╕реВрд░реНрдпреЛрджрдп</h4>
                <div id="sunrise" class="time">--:--</div>
              </div>
            </div>

            <div class="sun-box">
              <div class="sun-icon">ЁЯМД</div>
              <div class="sun-info">
                <h4>рд╕реВрд░реНрдпрд╛рд╕реНрдд</h4>
                <div id="sunset" class="time">--:--</div>
              </div>
            </div>
          </div>
        </div>

        <!-- table -->
        <div class="table-wrap">
          <table aria-label="рдкрдВрдЪрд╛рдВрдЧ рддрдкрд╢реАрд▓">
            <tbody>
              <tr>
                <td>ЁЯХЙя╕П</td>
                <td>рддрд┐рдереА</td>
                <td id="tithiName" class="tithi">--</td>
                <td id="tithiTime" class="time">--</td>
                <td id="tithiNext" class="next">--</td>
              </tr>

              <tr>
                <td>ЁЯХЙя╕П</td>
                <td>рд╡рд╛рд░</td>
                <td id="vaar">--</td>
                <td id="vaarTime">--</td>
                <td id="vaarSanskrit">--</td>
              </tr>

              <tr>
                <td>ЁЯХЙя╕П</td>
                <td>рдирдХреНрд╖рддреНрд░</td>
                <td id="nakshatra">--</td>
                <td id="nakshatraTime">--</td>
                <td id="nakshatraNext">--</td>
              </tr>

              <tr>
                <td>ЁЯХЙя╕П</td>
                <td>рдпреЛрдЧ</td>
                <td id="yoga">--</td>
                <td id="yogaTime">--</td>
                <td id="yogaNext">--</td>
              </tr>

              <tr>
                <td>ЁЯХЙя╕П</td>
                <td>рдХрд░рдг</td>
                <td id="karana">--</td>
                <td id="karanaTime">--</td>
                <td id="karanaNext">--</td>
              </tr>
            </tbody>
          </table>
        </div>

        <!-- rashi -->
        <div class="rashi-wrap">
          <div class="rashi">
            <div class="icon">ЁЯМЩ</div>
            <div class="label">рдЪрдВрджреНрд░</div>
            <div id="chandraRashi" class="val">--</div>
          </div>
          <div class="rashi">
            <div class="icon">тШАя╕П</div>
            <div class="label">рд╕реВрд░реНрдп</div>
            <div id="suryaRashi" class="val">--</div>
          </div>
          <div class="rashi">
            <div class="icon">ЁЯФЖ</div>
            <div class="label">рдЧреБрд░реБ</div>
            <div id="guruRashi" class="val">--</div>
          </div>
         
        </div>

        <!-- din vishesh -->
        <div id="dinVishesh" class="din-box" style="display:none"></div>

        <!-- footer -->
        <div class="footer">
          <div class="footer-left" id="footerLeft">
            <div class="name" id="footerName">--</div>
            <div class="office" id="footerOffice">--</div>
            <div class="contact" id="footerContact">рд╕рдВрдкрд░реНрдХ: --</div>
          </div>
          <div>
            <img id="footerPhoto" class="footer-photo" src="" alt="User Photo" style="display:none">
          </div>
        </div>
      </div>

      <!-- side form -->
      <aside class="side" aria-label="User form">
        <div class="form-header"><h3>ЁЯУЛ рдЖрдкрд▓реА рдорд╛рд╣рд┐рддреА рднрд░рд╛</h3></div>

        <div class="form-group">
          <label>ЁЯУ╕ рдлреЛрдЯреЛ</label>
          <div style="border:3px dashed #2e7d32;padding:12px;border-radius:8px;text-align:center;cursor:pointer" onclick="document.getElementById('userPhoto').click()">
            рдХреНрд▓рд┐рдХ рдХрд░рд╛ рдлреЛрдЯреЛ рдирд┐рд╡рдбрдгреНрдпрд╛рд╕рд╛рдареА
          </div>
          <input id="userPhoto" type="file" accept="image/*" style="display:none" />
          <img id="photoPreview" class="photo-preview" alt="preview" style="display:none" />
        </div>

        <div class="form-group"><label>ЁЯСд рдкреВрд░реНрдг рдирд╛рд╡</label><input id="userName" type="text" placeholder="рддреБрдордЪреЗ рдирд╛рд╡" style="width:100%;padding:10px;border-radius:8px;border:2px solid #e8e8e8"/></div>

        <div class="form-group"><label>ЁЯПв рдХрд╛рд░реНрдпрд╛рд▓рдп</label><input id="officeName" type="text" placeholder="рдХрд╛рд░реНрдпрд╛рд▓рдп рдирд╛рд╡" style="width:100%;padding:10px;border-radius:8px;border:2px solid #e8e8e8"/></div>

        <div class="form-group"><label>ЁЯУ▒ рд╕рдВрдкрд░реНрдХ</label><input id="userContact" type="tel" placeholder="рдореЛрдмрд╛рдИрд▓" style="width:100%;padding:10px;border-radius:8px;border:2px solid #e8e8e8"/></div>

        <div class="form-group"><label>ЁЯУН рдкрддреНрддрд╛</label><textarea id="userAddress" rows="3" placeholder="рдкрддреНрддрд╛ (рдкрд░реНрдпрд╛рдпреА)" style="width:100%;padding:10px;border-radius:8px;border:2px solid #e8e8e8"></textarea></div>

        <button class="btn-download" onclick="downloadPanchang()">ЁЯУе рдкрдВрдЪрд╛рдВрдЧ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рд╛</button>
      </aside>
    </div>
  </div>

<script>
/* CONFIG */
const PUNCH_JSON_PATH = './panchang.json'; // github root
const GANESH_URL = document.getElementById('ganeshImg').src;
const LOGO_IMG = document.getElementById('logoImg').src;

/* helpers */
function todayISO(){
  const d=new Date(); const y=d.getFullYear(); const m=String(d.getMonth()+1).padStart(2,'0'); const dd=String(d.getDate()).padStart(2,'0'); return `${y}-${m}-${dd}`;
}
async function loadJson(){
  try{
    const r = await fetch(PUNCH_JSON_PATH, {cache:'no-store'});
    if(!r.ok) throw new Error('panchang.json fetch failed: '+r.status);
    return await r.json();
  }catch(e){
    console.error(e);
    return null;
  }
}

/* fill UI */
async function fillFromJson(){
  const json = await loadJson();
  const key = todayISO();

  // set top date/day
  const d=new Date();
  const days = ['рд░рд╡рд┐рд╡рд╛рд░','рд╕реЛрдорд╡рд╛рд░','рдордВрдЧрд│рд╡рд╛рд░','рдмреБрдзрд╡рд╛рд░','рдЧреБрд░реБрд╡рд╛рд░','рд╢реБрдХреНрд░рд╡рд╛рд░','рд╢рдирд┐рд╡рд╛рд░'];
  document.getElementById('topDate').textContent = `${String(d.getDate()).padStart(2,'0')}-${String(d.getMonth()+1).padStart(2,'0')}-${d.getFullYear()}`;
  document.getElementById('topDay').textContent = days[d.getDay()];

  if(!json || !json[key]){
    // missing
    alert('рдЖрдЬрдЪрд╛ рдкрдВрдЪрд╛рдВрдЧ рдЙрдкрд▓рдмреНрдз рдирд╛рд╣реА тАФ рдХреГрдкрдпрд╛ panchang.json рдордзреНрдпреЗ ' + key + ' рдЬреЛрдбрд╛.');
    // show placeholders
    document.getElementById('tithiName').textContent='--';
    document.getElementById('tithiTime').textContent='--';
    document.getElementById('tithiNext').textContent='--';
    return;
  }

  const p = json[key];

  // tithi row: name | end | next
  document.getElementById('tithiName').textContent = p.tithi || '--';
  document.getElementById('tithiTime').textContent = p.tithi_end || '--';
  document.getElementById('tithiNext').textContent = p.tithi_next ? ('рдирдВрддрд░ тАФ ' + p.tithi_next) : (p.tithi_next || '--');

  // vaar
  const daysFull = days;
  document.getElementById('vaar').textContent = daysFull[new Date().getDay()] || '--';
  document.getElementById('vaarTime').textContent = p.vaar_time || '--';
  document.getElementById('vaarSanskrit').textContent = p.vaar_sanskrit || p.vaarSanskrit || '--';

  // nakshatra
  document.getElementById('nakshatra').textContent = p.nakshatra || '--';
  document.getElementById('nakshatraTime').textContent = p.nakshatra_end || '--';
  document.getElementById('nakshatraNext').textContent = p.nakshatra_next ? ('рдирдВрддрд░ тАФ ' + p.nakshatra_next) : (p.nakshatra_next || '--');

  // yoga
  document.getElementById('yoga').textContent = p.yog || '--';
  document.getElementById('yogaTime').textContent = p.yog_time || p.yogTime || '--';
  document.getElementById('yogaNext').textContent = p.yog_next ? ('рдирдВрддрд░ тАФ '+p.yog_next) : (p.yog_next || '--');

  // karana
  document.getElementById('karana').textContent = p.karan || '--';
  document.getElementById('karanaTime').textContent = p.karan_end || '--';
  document.getElementById('karanaNext').textContent = p.karan_next ? ('рдирдВрддрд░ тАФ '+p.karan_next) : (p.karan_next || '--');

  // sunrise/sunset
  document.getElementById('sunrise').textContent = p.sunrise || '--';
  document.getElementById('sunset').textContent = p.sunset || '--';

  // rashi
  document.getElementById('chandraRashi').textContent = p.moon_rashi || p.moonRashi || '--';
  document.getElementById('suryaRashi').textContent = p.sun_rashi || p.sunRashi || '--';
  document.getElementById('guruRashi').textContent = p.guru_rashi || p.guruRashi || '--';
  document.getElementById('shukraRashi').textContent = p.shukra_rashi || p.shukraRashi || '--';

  // shalivahan override
  if(p.shalivahan) document.getElementById('shalivahanLine').textContent = p.shalivahan;
  if(p.shalivahan_meta) document.getElementById('shalivahanMeta').textContent = p.shalivahan_meta;

  // din vishesh
  if(p.din_vishesh){
    const dv = document.getElementById('dinVishesh');
    dv.textContent = 'рджрд┐рдирд╡рд┐рд╢реЗрд╖: ' + p.din_vishesh;
    dv.style.display = 'block';
  } else {
    document.getElementById('dinVishesh').style.display='none';
  }
}

/* user photo preview & footer mapping */
document.getElementById('userPhoto').addEventListener('change', function(e){
  const f = e.target.files[0];
  if(!f) return;
  const r = new FileReader();
  r.onload = function(ev){
    const data = ev.target.result;
    // preview small
    const pv = document.getElementById('photoPreview');
    pv.src = data; pv.style.display = 'block';
    // footer photo
    const fp = document.getElementById('footerPhoto');
    fp.src = data; fp.style.display = 'block';
  };
  r.readAsDataURL(f);
});

function applyFooter(){
  const name = document.getElementById('userName').value.trim();
  const office = document.getElementById('officeName').value.trim();
  const contact = document.getElementById('userContact').value.trim();
  const addr = document.getElementById('userAddress').value.trim();

  if(name || office || contact || addr){
    document.getElementById('footerName').textContent = name || '--';
    document.getElementById('footerOffice').textContent = office || '';
    document.getElementById('footerContact').textContent = contact ? ('рд╕рдВрдкрд░реНрдХ: ' + contact) : 'рд╕рдВрдкрд░реНрдХ: --';
  } else {
    document.getElementById('footerName').textContent = '--';
    document.getElementById('footerOffice').textContent = '--';
    document.getElementById('footerContact').textContent = 'рд╕рдВрдкрд░реНрдХ: --';
    document.getElementById('footerPhoto').style.display='none';
  }
}

/* download function */
async function downloadPanchang(){
  applyFooter();
  // small delay to allow images update
  await new Promise(r=>setTimeout(r,220));

  const el = document.getElementById('panchangCard');
  html2canvas(el, {
    scale: 2,
    useCORS: true,
    allowTaint: true,
    backgroundColor: '#ffffff',
    width: 1080,
    height: 1729,
    logging: false
  }).then(canvas=>{
    canvas.toBlob(function(blob){
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      const user = document.getElementById('userName').value.trim();
      const d = new Date();
      const fname = user ? `рдкрдВрдЪрд╛рдВрдЧ_${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}-${String(d.getDate()).padStart(2,'0')}_${user.replace(/\s+/g,'_')}.png` : `рдкрдВрдЪрд╛рдВрдЧ_${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}-${String(d.getDate()).padStart(2,'0')}.png`;
      a.href = url; a.download = fname; document.body.appendChild(a); a.click(); a.remove();
      setTimeout(()=>{ URL.revokeObjectURL(url); alert('тЬЕ рдкрдВрдЪрд╛рдВрдЧ рдбрд╛рдЙрдирд▓реЛрдб рдкреВрд░реНрдг'); },400);
    }, 'image/png');
  }).catch(err=>{
    console.error('html2canvas error', err);
    alert('рдЪрд┐рддреНрд░ рдмрдирд╡рддрд╛рдирд╛ рддреНрд░реБрдЯреА рдЖрд▓реА тАФ console рддрдкрд╛рд╕рд╛.');
  });
}

/* init */
window.addEventListener('load', ()=>{
  fillFromJson();
  // midnight refresh
  setInterval(()=>{
    const now = new Date();
    if(now.getHours()===0 && now.getMinutes()===0) fillFromJson();
  }, 60000);
});
</script>
</body>
</html>
