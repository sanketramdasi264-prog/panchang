<!DOCTYPE html>
<html lang="mr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>‡§Ü‡§ú‡§ö‡§Ç ‡§™‡§Ç‡§ö‡§æ‡§Ç‡§ó ‚Äî OmKarmyog (Premium)</title>

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@700;800&family=Noto+Sans+Devanagari:wght@400;600;700&display=swap" rel="stylesheet">

  <!-- html2canvas -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

  <style>
    :root{
      --W:1080; --H:1729;
      --bg-cream:#fffaf3;
      --saffron:#e56a2e;
      --gold:#d9a64b;
      --green1:#0d7c31;
      --dark:#0b2b3a;
      --muted:#6d6d6d;
    }
    *{box-sizing:border-box;margin:0;padding:0}
    body{font-family:'Noto Sans Devanagari',sans-serif;background:linear-gradient(135deg,#1b5e20 0%,#2e7d32 100%);padding:20px;display:flex;justify-content:center;align-items:flex-start;min-height:100vh;color:var(--dark)}
    .container{max-width:1500px;margin:0 auto;width:100%}
    .main-content{display:grid;grid-template-columns:1080px 380px;gap:30px;justify-content:center}
    /* Panchang card */
    #panchangCard{width:1080px;height:1729px;background:var(--bg-cream);position:relative;box-shadow:0 20px 60px rgba(0,0,0,.35);overflow:hidden;border-radius:8px}
    /* Top white header */
    .top-white-section{height:160px;background:linear-gradient(180deg,#ffffff 0%,#f5f5f5 100%);display:flex;align-items:center;justify-content:space-between;padding:16px 36px;border-bottom:6px solid var(--gold)}
    .logo-left{width:120px;height:120px}
    .logo-left img{width:100%;height:100%;object-fit:contain;filter:drop-shadow(0 3px 12px rgba(0,0,0,.2))}
    .date-panel{text-align:left;flex:1;padding-left:12px}
    .date-panel .title{font-family:'Baloo 2';font-weight:800;font-size:40px;line-height:1;color:#111}
    .date-panel .date{font-size:30px;font-weight:700;color:#d32f2f;margin-top:6px}
    .date-panel .day{font-size:26px;font-weight:700;color:#d32f2f;margin-top:2px}
    .ganesh-top{width:220px;text-align:center}
    .ganesh-top img{width:200px;height:200px;object-fit:contain;filter:drop-shadow(0 6px 18px rgba(0,0,0,.35))}
    /* Red hero area with central photo frame */
    .red-section{background:linear-gradient(135deg,#d32f2f 0%,#c62828 100%);padding:20px 36px;position:relative}
    .red-border-frame{border:8px solid var(--gold);border-radius:10px;padding:18px;position:relative;height:820px;overflow:hidden;background:linear-gradient(180deg,rgba(255,255,255,0.02), rgba(255,255,255,0))}
    .trishul-left,.trishul-right{position:absolute;top:50%;transform:translateY(-50%);font-size:38px;color:var(--gold)}
    .trishul-left{left:10px}
    .trishul-right{right:10px}
    .photo-frame{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);width:520px;height:440px;background:#fff;border-radius:12px;overflow:hidden;display:flex;align-items:center;justify-content:center;box-shadow:0 10px 30px rgba(0,0,0,.35)}
    .photo-frame img{width:100%;height:100%;object-fit:cover}
    /* Shalivahan lines */
    .shake-bottom-section{padding:18px 36px;text-align:center;color:#fff;background:linear-gradient(135deg,#c62828 0%,#b71c1c 100%);border-bottom:6px solid var(--gold)}
    .shake-bottom-section h3{font-family:'Baloo 2';font-size:34px;margin-bottom:6px}
    .shake-bottom-section p{font-size:20px;font-weight:600;margin:0}
    /* blue social / sunrise-sunset */
    .blue-social-section{padding:18px 36px;background:linear-gradient(135deg,#1565c0 0%,#0d47a1 100%);border-bottom:6px solid var(--gold)}
    .social-wave{height:8px;background:linear-gradient(90deg,var(--gold) 0%, #ffed4e 50%, var(--gold) 100%);border-radius:4px;margin-bottom:12px}
    .social-content{display:flex;gap:24px;justify-content:center;align-items:center}
    .sun-box{display:flex;align-items:center;gap:12px;background:rgba(255,255,255,0.08);padding:12px 22px;border-radius:40px;backdrop-filter:blur(6px)}
    .sun-icon{width:56px;height:56px;background:#fff;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:26px;box-shadow:0 3px 10px rgba(0,0,0,.2)}
    .sun-info h4{color:#fff;font-size:14px;margin-bottom:2px}
    .sun-info .time{color:var(--gold);font-size:26px;font-weight:800}
    /* Panchang table */
    .panchang-table-section{padding:28px 36px;background:linear-gradient(180deg,#fff8e1 0%, #ffffff 100%)}
    table{width:100%;border-collapse:collapse;border:4px solid #ff9800}
    th,td{padding:14px 10px;text-align:center;border:2px solid #ff9800}
    th{background:linear-gradient(135deg,#ffd700 0%,#ffb300 100%);color:#c62828;font-size:18px;font-weight:900}
    td{font-size:18px;font-weight:700}
    td.tithiName{font-size:22px}
    td.tithiTime{color:#c62828;font-size:20px}
    td.rightSmall{font-size:16px;color:#1565c0}
    /* Rashi section */
    .rashi-section{padding:24px 36px;background:#fff;display:grid;grid-template-columns:repeat(3,1fr);gap:18px}
    .rashi-box{background:#fff;border:3px solid #ff9800;border-radius:14px;padding:18px;text-align:center;box-shadow:0 4px 12px rgba(0,0,0,.08)}
    .rashi-box .icon{font-size:28px;margin-bottom:6px}
    .rashi-box .label{color:#666;font-size:14px}
    .rashi-box .value{color:#c62828;font-weight:900;font-size:20px}
    /* DIN VISHESH GOLD BOX (Option A) */
    .din-vishesh{margin:20px 36px;padding:18px;border-radius:12px;background:linear-gradient(180deg,#fff8e6 0%,#fff2d9 100%);border:2px solid #e2a92f;color:#0b2b3a;font-size:18px;font-weight:700;text-align:center}
    /* footer */
    .bottom-white-footer{background:linear-gradient(180deg,#f5f5f5 0%,#ffffff 100%);padding:24px 36px;border-top:6px solid var(--gold);display:flex;align-items:center;justify-content:space-between;min-height:120px}
    .footer-left{display:flex;flex-direction:column;gap:8px}
    .footer-title{font-family:'Baloo 2';font-weight:800;color:#ffd84a;font-size:32px}
    .footer-sub{color:#333;font-size:18px;font-weight:700}
    .footer-contact{color:#333;font-size:18px}
    .footer-photo{width:150px;height:150px;border-radius:12px;object-fit:cover;border:5px solid var(--gold);box-shadow:0 6px 20px rgba(0,0,0,.22)}
    /* right-side user form */
    .user-form-card{background:#fff;border-radius:16px;padding:20px;box-shadow:0 15px 50px rgba(0,0,0,.3);position:sticky;top:20px}
    .form-header{background:linear-gradient(135deg,#1b5e20 0%,#2e7d32 100%);color:#fff;padding:14px;border-radius:12px;text-align:center;margin:-20px -20px 18px -20px}
    .form-header h3{font-size:20px;margin:0}
    .form-group{margin-bottom:14px}
    .photo-upload-box{border:3px dashed #2e7d32;border-radius:10px;padding:16px;text-align:center;cursor:pointer;background:#f5f5f5}
    .photo-preview{width:150px;height:150px;border-radius:10px;object-fit:cover;margin:12px auto;display:none;border:5px solid #2e7d32}
    .btn-download{width:100%;padding:14px;background:linear-gradient(135deg,#d32f2f 0%,#c62828 100%);color:#fff;border:none;border-radius:10px;font-weight:800;font-size:18px;cursor:pointer;box-shadow:0 10px 28px rgba(0,0,0,.25)}
    @media(max-width:1400px){.main-content{grid-template-columns:1fr}}
    @media(max-width:900px){#panchangCard{transform:scale(.78);transform-origin:top center}}
  </style>
</head>
<body>
  <div class="container">
    <div class="main-content">
      <!-- Panchang card -->
      <div id="panchangCard" role="region" aria-label="‡§™‡§Ç‡§ö‡§æ‡§Ç‡§ó ‡§ï‡§æ‡§∞‡•ç‡§°">
        <!-- Top header -->
        <div class="top-white-section">
          <div class="logo-left">
            <img src="https://blogger.googleusercontent.com/img/a/AVvXsEghUXDnRLeFXsuapWEpRem_Mtzst5Ae9zlttWprP9nI7dQ_Rh41nkHP3PqCiHrZo1YKUiMvbHaPZC6VZEBCSvuAvzQOVF7MxUon4i3Hdko0qGWwyl4BQ44KeAe-6qQACSUB8k-3wdI6N2Bt-8xsQSQnHW-a2AMw9SwT0hK4b5Ej5zmN_anbnY1pX2TC9pwR=s500" alt="logo">
          </div>

          <div class="date-panel">
            <div class="title">‡§Ü‡§ú‡§ö‡•á ‡§™‡§Ç‡§ö‡§æ‡§Ç‡§ó</div>
            <div class="date" id="topDate">--</div>
            <div class="day" id="topDay">--</div>
          </div>

          <div class="ganesh-top">
            <img id="ganeshImg" src="https://raw.githubusercontent.com/sanketramdasi264-prog/panchang/main/pngtree-artistic-vinayaka-chavithi-celebrations-for-ganesh-chaturthi-bal-free-transparent-png-image_14089909.png" alt="ganesh">
          </div>
        </div>

        <!-- Red hero -->
        <div class="red-section">
          <div class="red-border-frame">
            <div class="trishul-left">üî±</div>
            <div class="trishul-right">üî±</div>
            <div class="photo-frame" id="photoFrame">
              <!-- user photo inserted here -->
            </div>
          </div>
        </div>

        <!-- Shalivahan -->
        <div class="shake-bottom-section">
          <h3 id="shalivahanLine">‡§∂‡§æ‡§≤‡§ø‡§µ‡§æ‡§π‡§® ‡§∂‡§ï‡•á ‡•ß‡•Ø‡•™‡•≠</h3>
          <p id="shalivahanMeta">‡§µ‡§ø‡§∂‡•ç‡§µ‡§æ‡§µ‡§∏‡•Å‡§®‡§æ‡§Æ‡§∏‡§Ç‡§µ‡§§‡•ç‡§∏‡§∞, ‡§¶‡§ï‡•ç‡§∑‡§ø‡§£‡§æ‡§Ø‡§®, ‡§∂‡§∞‡§¶‡•ç‡§ã‡§§‡•Ç, ‡§ï‡§æ‡§∞‡•ç‡§§‡§ø‡§ï ‡§Æ‡§æ‡§∏, ‡§ï‡•É‡§∑‡•ç‡§£ ‡§™‡§ï‡•ç‡§∑</p>
        </div>

        <!-- Blue sunrise/sunset -->
        <div class="blue-social-section">
          <div class="social-wave"></div>
          <div class="social-content">
            <div class="sun-box">
              <div class="sun-icon">üåÖ</div>
              <div class="sun-info">
                <h4>‡§∏‡•Ç‡§∞‡•ç‡§Ø‡•ã‡§¶‡§Ø</h4>
                <div class="time" id="sunrise">--:--</div>
              </div>
            </div>
            <div class="sun-box">
              <div class="sun-icon">üåÑ</div>
              <div class="sun-info">
                <h4>‡§∏‡•Ç‡§∞‡•ç‡§Ø‡§æ‡§∏‡•ç‡§§</h4>
                <div class="time" id="sunset">--:--</div>
              </div>
            </div>
          </div>
        </div>

        <!-- Panchang table -->
        <div class="panchang-table-section">
          <table aria-label="‡§™‡§Ç‡§ö‡§æ‡§Ç‡§ó ‡§§‡§™‡§∂‡•Ä‡§≤">
            <thead>
              <tr>
                <th>üïâÔ∏è</th>
                <th>‡§ò‡§ü‡§®‡§æ</th>
                <th>‡§Æ‡§æ‡§π‡§ø‡§§‡•Ä</th>
                <th>‡§µ‡•á‡§≥</th>
                <th>‡§á‡§§‡§∞</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>üïâÔ∏è</td>
                <td>‡§§‡§ø‡§•‡•Ä</td>
                <td id="tithiName" class="tithiName">--</td>
                <td id="tithiTime" class="tithiTime">--</td>
                <td></td>
              </tr>
              <tr>
                <td>üïâÔ∏è</td>
                <td>‡§µ‡§æ‡§∞</td>
                <td id="vaar">--</td>
                <td id="vaarSanskrit">--</td>
                <td></td>
              </tr>
              <tr>
                <td>üïâÔ∏è</td>
                <td>‡§®‡§ï‡•ç‡§∑‡§§‡•ç‡§∞</td>
                <td id="nakshatra">--</td>
                <td id="nakshatraTime">--</td>
                <td></td>
              </tr>
              <tr>
                <td>üïâÔ∏è</td>
                <td>‡§Ø‡•ã‡§ó</td>
                <td id="yoga">--</td>
                <td id="yogaTime">--</td>
                <td></td>
              </tr>
              <tr>
                <td>üïâÔ∏è</td>
                <td>‡§ï‡§∞‡§£</td>
                <td id="karana">--</td>
                <td id="karanaTime">--</td>
                <td></td>
              </tr>
            </tbody>
          </table>
        </div>

        <!-- Rashi boxes -->
        <div class="rashi-section">
          <div class="rashi-box">
            <div class="icon">üåô</div>
            <div class="label">‡§ö‡§Ç‡§¶‡•ç‡§∞ ‡§∞‡§æ‡§∂‡•Ä</div>
            <div class="value" id="chandraRashi">--</div>
          </div>
          <div class="rashi-box">
            <div class="icon">‚òÄÔ∏è</div>
            <div class="label">‡§ó‡•Å‡§∞‡•Å ‡§∞‡§æ‡§∂‡•Ä</div>
            <div class="value" id="guruRashi">--</div>
          </div>
          <div class="rashi-box">
            <div class="icon">‚≠ê</div>
            <div class="label">‡§∂‡•Å‡§ï‡•ç‡§∞ ‡§∞‡§æ‡§∂‡•Ä</div>
            <div class="value" id="shukraRashi">--</div>
          </div>
        </div>

        <!-- DIN VISHESH (before footer) -->
        <div id="dinVishesh" class="din-vishesh" style="display:none"></div>

        <!-- Footer -->
        <div class="bottom-white-footer">
          <div class="footer-left" id="footerContent">
            <div class="footer-title"> <span id="footerName">--</span></div>
            <div class="footer-sub" id="footerOffice">--</div>
            <div class="footer-contact">‡§∏‡§Ç‡§™‡§∞‡•ç‡§ï: <span id="footerContact">--</span></div>
          </div>
          <div>
            <img id="footerPhoto" class="footer-photo" src="" alt="User Photo" style="display:none">
          </div>
        </div>
      </div>

      <!-- User form -->
      <div class="user-form-card" aria-label="User form">
        <div class="form-header">
          <h3>üìã ‡§Ü‡§™‡§≤‡•Ä ‡§Æ‡§æ‡§π‡§ø‡§§‡•Ä ‡§≠‡§∞‡§æ</h3>
          <p style="font-size:.9em;margin-top:8px;opacity:.9">(‡§™‡§∞‡•ç‡§Ø‡§æ‡§Ø‡•Ä)</p>
        </div>

        <div class="form-group">
          <label>üì∏ ‡§Ü‡§™‡§≤‡§æ ‡§´‡•ã‡§ü‡•ã</label>
          <div class="photo-upload-box" onclick="document.getElementById('userPhoto').click()">
            <div class="upload-icon">üì∑</div>
            <p><strong>‡§´‡•ã‡§ü‡•ã ‡§®‡§ø‡§µ‡§°‡§æ</strong></p>
          </div>
          <input type="file" id="userPhoto" accept="image/*" style="display:none">
          <img id="photoPreview" class="photo-preview" alt="Preview">
        </div>

        <div class="form-group">
          <label>üë§ ‡§™‡•Ç‡§∞‡•ç‡§£ ‡§®‡§æ‡§µ</label>
          <input type="text" id="userName" placeholder="‡§§‡•Å‡§Æ‡§ö‡•á ‡§™‡•Ç‡§∞‡•ç‡§£ ‡§®‡§æ‡§µ">
        </div>

        <div class="form-group">
          <label>üè¢ ‡§ï‡§æ‡§∞‡•ç‡§Ø‡§æ‡§≤‡§Ø / ‡§µ‡•ç‡§Ø‡§µ‡§∏‡§æ‡§Ø</label>
          <input type="text" id="officeName" placeholder="‡§ï‡§æ‡§∞‡•ç‡§Ø‡§æ‡§≤‡§Ø‡§æ‡§ö‡•á ‡§®‡§æ‡§µ">
        </div>

        <div class="form-group">
          <label>üì± ‡§∏‡§Ç‡§™‡§∞‡•ç‡§ï ‡§ï‡•ç‡§∞‡§Æ‡§æ‡§Ç‡§ï</label>
          <input type="tel" id="userContact" placeholder="‡§Æ‡•ã‡§¨‡§æ‡§à‡§≤ ‡§®‡§Ç‡§¨‡§∞">
        </div>

        <div class="form-group">
          <label>üìç ‡§™‡§§‡•ç‡§§‡§æ</label>
          <textarea id="userAddress" rows="3" placeholder="‡§™‡§§‡•ç‡§§‡§æ (‡§™‡§∞‡•ç‡§Ø‡§æ‡§Ø‡•Ä)"></textarea>
        </div>

        <button class="btn-download" onclick="downloadPanchang()">üì• ‡§™‡§Ç‡§ö‡§æ‡§Ç‡§ó ‡§°‡§æ‡§â‡§®‡§≤‡•ã‡§° ‡§ï‡§∞‡§æ</button>
      </div>
    </div>
  </div>

  <script>
    // CONFIG - change only if necessary
    const PUNCH_JSON_PATH = './panchang.json'; // root of repo (GitHub Pages will serve)
    // Utility: format today's ISO key YYYY-MM-DD
    function todayISO(){
      const d = new Date();
      const y = d.getFullYear();
      const m = String(d.getMonth()+1).padStart(2,'0');
      const dd = String(d.getDate()).padStart(2,'0');
      return `${y}-${m}-${dd}`;
    }

    async function loadPanchangJson(){
      try{
        const res = await fetch(PUNCH_JSON_PATH, {cache:'no-store'});
        if(!res.ok) throw new Error('panchang.json fetch failed: ' + res.status);
        return await res.json();
      }catch(err){
        console.error('JSON load error', err);
        return null;
      }
    }

    // Map JSON fields to UI
    async function fillFromJson(){
      const json = await loadPanchangJson();
      const key = todayISO();
      const topDateEl = document.getElementById('topDate');
      const topDayEl = document.getElementById('topDay');

      const d = new Date();
      const days = ['‡§∞‡§µ‡§ø‡§µ‡§æ‡§∞','‡§∏‡•ã‡§Æ‡§µ‡§æ‡§∞','‡§Æ‡§Ç‡§ó‡§≥‡§µ‡§æ‡§∞','‡§¨‡•Å‡§ß‡§µ‡§æ‡§∞','‡§ó‡•Å‡§∞‡•Å‡§µ‡§æ‡§∞','‡§∂‡•Å‡§ï‡•ç‡§∞‡§µ‡§æ‡§∞','‡§∂‡§®‡§ø‡§µ‡§æ‡§∞'];
      topDateEl.textContent = `${String(d.getDate()).padStart(2,'0')}-${String(d.getMonth()+1).padStart(2,'0')}-${d.getFullYear()}`;
      topDayEl.textContent = days[d.getDay()];

      if(!json || !json[key]){
        // show friendly missing message on the card
        document.getElementById('tithiName').textContent = '--';
        document.getElementById('tithiTime').textContent = '--';
        document.getElementById('vaar').textContent = days[d.getDay()];
        document.getElementById('nakshatra').textContent = '--';
        document.getElementById('yoga').textContent = '--';
        document.getElementById('karana').textContent = '--';
        document.getElementById('chandraRashi').textContent = '--';
        // show day-special message if you want
        alert('‡§Ü‡§ú‡§ö‡§æ ‡§™‡§Ç‡§ö‡§æ‡§Ç‡§ó ‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§®‡§æ‡§π‡•Ä ‚Äî ‡§ï‡•É‡§™‡§Ø‡§æ panchang.json ‡§Æ‡§ß‡•ç‡§Ø‡•á ‡§Ü‡§ú‡§ö‡•Ä ‡§§‡§æ‡§∞‡•Ä‡§ñ ‡§ú‡•ã‡§°‡§æ ('+key+')');
        // Optionally show placeholder big text on canvas (when exporting user will see)
        return;
      }

      const p = json[key];

      // tithi: only name + tithi_end (user requested simplified)
      document.getElementById('tithiName').textContent = p.tithi || '--';
      document.getElementById('tithiTime').textContent = p.tithi_end || '--';

      // vaar / sanskrit
      document.getElementById('vaar').textContent = days[d.getDay()] || '--';
      document.getElementById('vaarSanskrit').textContent = p.vaar_sanskrit || p.vaarSanskrit || '';

      // nakshatra
      document.getElementById('nakshatra').textContent = p.nakshatra || '--';
      document.getElementById('nakshatraTime').textContent = p.nakshatra_end || '--';

      // yoga
      document.getElementById('yoga').textContent = p.yog || '--';
      document.getElementById('yogaTime').textContent = p.yog_time || p.yogTime || '--';

      // karana
      document.getElementById('karana').textContent = p.karan || '--';
      document.getElementById('karanaTime').textContent = p.karan_end || p.karan_end || '--';

      // sunrise / sunset
      document.getElementById('sunrise').textContent = p.sunrise || '--';
      document.getElementById('sunset').textContent = p.sunset || '--';

      // rashi boxes
      document.getElementById('chandraRashi').textContent = p.moon_rashi || p.moonRashi || '--';
      document.getElementById('guruRashi').textContent = p.guru_rashi || p.guruRashi || '--';
      document.getElementById('shukraRashi').textContent = p.shukra_rashi || p.shukraRashi || '--';

      // din vishesh (display before footer)
      if(p.din_vishesh){
        const dv = document.getElementById('dinVishesh');
        dv.textContent = '‡§¶‡§ø‡§®‡§µ‡§ø‡§∂‡•á‡§∑: ' + p.din_vishesh;
        dv.style.display = 'block';
      }

      // shalivahan meta if present override
      if(p.shalivahan) document.getElementById('shalivahanLine').textContent = p.shalivahan;
      if(p.shalivahan_meta) document.getElementById('shalivahanMeta').textContent = p.shalivahan_meta;
    }

    // user photo preview + set in photo-frame
    document.getElementById('userPhoto').addEventListener('change', function(e){
      const f = e.target.files[0];
      if(!f) return;
      const r = new FileReader();
      r.onload = function(ev){
        document.getElementById('photoPreview').src = ev.target.result;
        document.getElementById('photoPreview').style.display = 'block';
        // set in main photo frame
        const pf = document.getElementById('photoFrame');
        pf.innerHTML = `<img src="${ev.target.result}" alt="User Photo">`;
        // footer photo
        const footImg = document.getElementById('footerPhoto');
        footImg.src = ev.target.result;
        footImg.style.display = 'block';
      };
      r.readAsDataURL(f);
    });

    // when user fills details, map to footer before download
    function applyUserFooter(){
      const name = document.getElementById('userName').value.trim();
      const office = document.getElementById('officeName').value.trim();
      const contact = document.getElementById('userContact').value.trim();
      const addr = document.getElementById('userAddress').value.trim();

      if(name || office || contact || addr){
        document.getElementById('footerContent').style.display = 'flex';
        if(name) document.getElementById('footerName').textContent = name; else document.getElementById('footerName').textContent = '--';
        if(office) document.getElementById('footerOffice').textContent = office; else document.getElementById('footerOffice').textContent = '';
        if(contact) document.getElementById('footerContact').textContent = contact; else document.getElementById('footerContact').textContent = '--';
      } else {
        document.getElementById('footerContent').style.display = 'none';
      }
    }

    // download & render using html2canvas
    async function downloadPanchang(){
      applyUserFooter();
      // small delay for rendering
      await new Promise(r=>setTimeout(r,220));

      const card = document.getElementById('panchangCard');

      // ensure images have crossOrigin where possible; html2canvas useCORS true.
      html2canvas(card, {
        scale: 2,
        useCORS: true,
        allowTaint: true,
        backgroundColor: '#ffffff',
        width: 1080,
        height: 1729,
        logging: false
      }).then(canvas=>{
        canvas.toBlob(function(blob){
          const url = URL.createObjectURL(blob);
          const a = document.createElement('a');
          const userName = document.getElementById('userName').value.trim();
          const today = new Date();
          const fname = userName ? `‡§™‡§Ç‡§ö‡§æ‡§Ç‡§ó_${today.getFullYear()}-${String(today.getMonth()+1).padStart(2,'0')}-${String(today.getDate()).padStart(2,'0')}_${userName.replace(/\s+/g,'_')}.png` : `‡§™‡§Ç‡§ö‡§æ‡§Ç‡§ó_${today.getFullYear()}-${String(today.getMonth()+1).padStart(2,'0')}-${String(today.getDate()).padStart(2,'0')}.png`;
          a.href = url; a.download = fname; document.body.appendChild(a); a.click(); a.remove();
          setTimeout(()=>{ URL.revokeObjectURL(url); alert('‚úÖ ‡§™‡§Ç‡§ö‡§æ‡§Ç‡§ó ‡§°‡§æ‡§â‡§®‡§≤‡•ã‡§° ‡§™‡•Ç‡§∞‡•ç‡§£.'); },500);
        }, 'image/png');
      }).catch(err=>{
        console.error('html2canvas error',err);
        alert('‡§ö‡§ø‡§§‡•ç‡§∞ ‡§¨‡§®‡§µ‡§§‡§æ‡§®‡§æ ‡§§‡•ç‡§∞‡•Å‡§ü‡•Ä - console ‡§§‡§™‡§æ‡§∏‡§æ.');
      });
    }

    // Init on load
    window.addEventListener('load', function(){
      fillFromJson();
      // auto update midnight check (if you keep page open)
      setInterval(()=>{
        const now = new Date();
        if(now.getHours()===0 && now.getMinutes()===0){
          fillFromJson();
        }
      },60000);
    });
  </script>
</body>
</html>
