<!doctype html>
<html lang="mr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>‡§Ü‡§ú‡§ö‡•á ‡§™‡§Ç‡§ö‡§æ‡§Ç‡§ó ‚Äî OmKarmyog</title>

<!-- FONTS -->
<link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@700;800&family=Noto+Sans+Devanagari:wght@400;600;700;900&family=Arya:wght@700&display=swap" rel="stylesheet">

<!-- HTML2CANVAS -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

<style>
  :root{
    --max-w:1080px;
    --cream:#fff9f1;
    --maroon:#4e0f0f;
    --gold:#ffd54a;
    --accent:#c62828;
    --blue1:#1565c0;
    --blue2:#0d47a1;
    --muted:#6b6b6b;
  }

  *{box-sizing:border-box;margin:0;padding:0}
  body{
    font-family:'Noto Sans Devanagari',sans-serif;
    background:#eef2f1;
    display:flex;
    justify-content:center;
    padding:14px;
  }

  .page{width:100%;max-width:var(--max-w)}

  /* USER INPUT PANEL */
  .input-panel{
    background:#fff;border-radius:12px;padding:16px;margin-bottom:16px;
    box-shadow:0 10px 30px rgba(0,0,0,.08);
  }
  .input-panel h2{
    font-size:20px;font-weight:900;margin-bottom:10px;color:#222;
  }
  .ipt-row{display:flex;flex-wrap:wrap;gap:16px}

  .ipt-box{flex:1;min-width:240px}
  label{font-weight:700;margin-bottom:4px;display:block}
  input[type="text"], input[type="tel"], input[type="file"]{
    width:100%;padding:10px;font-size:15px;border:2px solid #eee;border-radius:8px;
  }
  #preview{width:120px;height:120px;margin-top:8px;border-radius:8px;border:3px solid var(--accent);object-fit:cover;display:none}

  .btn-apply{
    background:linear-gradient(135deg,var(--accent),#9c2020);
    color:#fff;border:0;padding:12px;font-weight:900;border-radius:8px;margin-top:8px;cursor:pointer;
  }

  /* CARD */
  #panchangCard{
    background:var(--cream);
    border-radius:12px;
    overflow:hidden;
    box-shadow:0 24px 50px rgba(0,0,0,.16);
  }

.top-header{
    display:flex;
    justify-content:space-between;
    align-items:flex-start;
    padding:12px 18px;
    background:#fff;
    border-bottom:6px solid var(--gold);
    position:relative;
}
.left-info{max-width:42%}

.title{
    font-family:'Baloo 2';
    font-size:30px;
    font-weight:800;
    color:#0b2b3a;
    line-height:1.15;
}
.date{
    font-size:19px;
    font-weight:900;
    color:var(--accent);
    margin-top:4px;
}
.day{
    font-size:16px;
    font-weight:700;
    color:var(--accent);
    margin-top:2px;
}

.ganesh-center{
    width:150px;
    margin:0 auto;
    padding:10px;
    background:#fff;
    border-radius:12px;
    display:flex;
    justify-content:center;
    align-items:center;
    position:relative;
    top:0;
}
.ganesh-center img{
    width:100%;
    height:auto;
    object-fit:contain;
    display:block;
}

.logo-right{
    width:120px;
    display:flex;
    align-items:flex-start;
    justify-content:flex-end;
    margin-right:-10px;
}
.logo-right img{
    max-width:120px;
}

  /* SHALIVAHAN */
  .shalivahan{
    background:linear-gradient(180deg,var(--accent),#8c1c1c);
    color:#fff;
    padding:16px;
    text-align:center;
    border-bottom:6px solid var(--gold)
  }
 .shalivahan h3{
    font-family:'Baloo 2';
    font-size:20px;
    font-weight:900;
    margin-bottom:4px;
    line-height:1.1;
}
.shalivahan p{
    font-size:16px;
    font-weight:700;
    margin:0;
    line-height:1.1;
    opacity:0.95;
}

  /* SUN BOX */
  .sun-row{
    display:flex;
    justify-content:center;
    gap:12px;
    padding:14px;
    background:linear-gradient(90deg,var(--blue1),var(--blue2));
    border-bottom:6px solid var(--gold);
  }
 .sun-box{
    display:flex;
    align-items:center;
    gap:10px;
    padding:8px 12px;
    border-radius:40px;
    background:rgba(255,255,255,0.10);
}
.sun-icon{
    font-size:24px;
}
.sun-data{
    display:flex;
    flex-direction:row;
    align-items:center;
    gap:6px;
}
.sun-data h4{
    color:#fff;
    font-weight:700;
    font-size:16px;
}
.sun-data .time{
    color:var(--gold);
    font-size:20px;
    font-weight:900;
}

/* üåô NEW BLACK MOON + RAHUKAAL ROW */
.moon-row{
  display:flex;
  justify-content:center;
  gap:12px;
  padding:14px;
  background:#000;
  border-bottom:6px solid var(--gold);
}
.black-box{
  background:rgba(255,255,255,0.10);
  padding:8px 12px;
  border-radius:40px;
}
.black-box h4{
  color:#fff;
  font-size:16px;
  font-weight:700;
}
.black-box .time{
  color:var(--gold);
  font-size:20px;
  font-weight:900;
  }
  <!-- üåô NEW BLACK MOON + RAHUKAAL ROW -->
<div class="moon-row">
    <div class="black-box">
        <h4>üåô ‡§ö‡§Ç‡§¶‡•ç‡§∞‡•ã‡§¶‡§Ø</h4>
        <div id="moonrise" class="time">--</div>
    </div>

    <div class="black-box">
        <h4>‚ö´ ‡§∞‡§æ‡§π‡•Å‡§ï‡§æ‡§≤</h4>
        <div id="rahu" class="time">--</div>
    </div>
</div>


<!-- TABLE SECTION -->
<div class="table-section">
  <table class="p-table">
    <tbody>

      <tr>
        <td class="event">‡§§‡§ø‡§•‡•Ä</td>
        <td class="info" id="tithi">--</td>
        <td class="time" id="tithi_end">--</td>
        <td class="next" id="tithi_next">--</td>
      </tr>

      <tr>
        <td class="event">‡§µ‡§æ‡§∞</td>
        <td class="info" id="vaar">--</td>
        <td class="time" id="vaar_time">--</td>
        <td class="next" id="vaar_sanskrit">--</td>
      </tr>

      <tr>
        <td class="event">‡§®‡§ï‡•ç‡§∑‡§§‡•ç‡§∞</td>
        <td class="info" id="nak">--</td>
        <td class="time" id="nak_end">--</td>
        <td class="next" id="nak_next">--</td>
      </tr>

      <tr>
        <td class="event">‡§Ø‡•ã‡§ó</td>
        <td class="info" id="yog">--</td>
        <td class="time" id="yog_time">--</td>
        <td class="next" id="yog_next">--</td>
      </tr>

      <tr>
        <td class="event">‡§ï‡§∞‡§£</td>
        <td class="info" id="kar">--</td>
        <td class="time" id="kar_end">--</td>
        <td class="next" id="kar_next">--</td>
      </tr>

    </tbody>
  </table>
</div>


<!-- RASHI SECTION -->
<div class="rashi-section">

 <div class="rashi-card">
    <div class="icon">üåô</div>
    <div class="rashi-text-block">
        <div class="label">‡§ö‡§Ç‡§¶‡•ç‡§∞‡§∞‡§æ‡§∂‡•Ä</div>
        <div class="val" id="moon_rashi">--</div>
    </div>
 </div>

 <div class="rashi-card">
    <div class="icon">‚òÄÔ∏è</div>
    <div class="rashi-text-block">
        <div class="label">‡§∏‡•Ç‡§∞‡•ç‡§Ø‡§∞‡§æ‡§∂‡•Ä</div>
        <div class="val" id="sun_rashi">--</div>
    </div>
 </div>

 <div class="rashi-card">
    <div class="icon">üîÜ</div>
    <div class="rashi-text-block">
        <div class="label">‡§ó‡•Å‡§∞‡•Å‡§∞‡§æ‡§∂‡•Ä</div>
        <div class="val" id="guru_rashi">--</div>
    </div>
 </div>

</div>


<!-- DIN VISHESH -->
<div id="din_vishesh" class="din-box"></div>


<!-- FOOTER INSIDE IMAGE -->
<div class="footer">
  <div class="footer-left">
    <div id="footer_name">‡§Ü‡§™‡§≤‡•á ‡§®‡§æ‡§µ</div>
    <div id="footer_office"></div>
    <div id="footer_address"></div>
    <div id="footer_contact"></div>
  </div>

  <img id="footer_img" />
</div>

</div>  <!-- END #panchangCard -->


<!-- DOWNLOAD BUTTON -->
<button id="downloadFab">Download Panchang</button>

</div> <!-- END .page -->
  <script>
/* -------- PANCHANG DATA LOADING LOGIC -------- */

const LOCAL_JSON="./panchang.json";
const FALLBACK_JSON="https://sanketramdasi264-prog.github.io/panchang/panchang.json";

const daysMR=['‡§∞‡§µ‡§ø‡§µ‡§æ‡§∞','‡§∏‡•ã‡§Æ‡§µ‡§æ‡§∞','‡§Æ‡§Ç‡§ó‡§≥‡§µ‡§æ‡§∞','‡§¨‡•Å‡§ß‡§µ‡§æ‡§∞','‡§ó‡•Å‡§∞‡•Å‡§µ‡§æ‡§∞','‡§∂‡•Å‡§ï‡•ç‡§∞‡§µ‡§æ‡§∞','‡§∂‡§®‡§ø‡§µ‡§æ‡§∞'];

function todayISO(){
  const d=new Date();
  return `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}-${String(d.getDate()).padStart(2,'0')}`
}

function fmtDate(d=new Date()){
  return `${String(d.getDate()).padStart(2,'0')}-${String(d.getMonth()+1).padStart(2,'0')}-${d.getFullYear()}`
}

async function fetchPanchangJson(){
  try{
    const r=await fetch(LOCAL_JSON,{cache:"no-store"});
    if(r.ok) return await r.json();
  }catch(e){}

  try{
    const r2=await fetch(FALLBACK_JSON,{cache:"no-store"});
    if(r2.ok) return await r2.json();
  }catch(e){}

  return null;
}

async function populatePanchang(){
  const data=await fetchPanchangJson();
  const key=todayISO();
  const now=new Date();

  document.getElementById("hdrDate").textContent=fmtDate(now);
  document.getElementById("hdrDay").textContent=daysMR[now.getDay()];

  if(!data || !data[key]){
    console.warn("Missing panchang",key);
    return;
  }

  const p=data[key];

  /* TOP SHALIVAHAN */
  if(p.shalivahan) document.getElementById("shalivahanLine").textContent=p.shalivahan;
  if(p.shalivahan_meta) document.getElementById("shalivahanMeta").textContent=p.shalivahan_meta;

  /* SUN DATA */
  document.getElementById("sunrise").textContent=p.sunrise || "--";
  document.getElementById("sunset").textContent=p.sunset || "--";

  /* üåô MOONRISE + RAHU ADDED */
  document.getElementById("moonrise").textContent = p.moonrise || "--";
  document.getElementById("rahu").textContent     = p.rahu || "--";

  /* TABLE DATA */
  const endP=v=> v ? (v+' ‡§™') : '--';
  const nextN=v=> v ? ('‡§®‡§Ç ‚Äî '+v) : '--';

  document.getElementById("tithi").textContent=p.tithi || "--";
  document.getElementById("tithi_end").textContent=endP(p.tithi_end);
  document.getElementById("tithi_next").textContent=nextN(p.tithi_next);

  document.getElementById("vaar").textContent=p.vaar || daysMR[now.getDay()];
  document.getElementById("vaar_time").textContent=p.vaar_time || "--";
  document.getElementById("vaar_sanskrit").textContent=p.vaar_sanskrit || "--";

  document.getElementById("nak").textContent=p.nakshatra || "--";
  document.getElementById("nak_end").textContent=endP(p.nakshatra_end);
  document.getElementById("nak_next").textContent=nextN(p.nakshatra_next);

  document.getElementById("yog").textContent=p.yog || "--";
  document.getElementById("yog_time").textContent=p.yog_time || "--";
  document.getElementById("yog_next").textContent=nextN(p.yog_next);

  document.getElementById("kar").textContent=p.karan || "--";
  document.getElementById("kar_end").textContent=endP(p.karan_end);
  document.getElementById("kar_next").textContent=nextN(p.karan_next);

  /* RASHI */
  document.getElementById("moon_rashi").textContent=p.moon_rashi || "--";
  document.getElementById("sun_rashi").textContent=p.sun_rashi || "--";
  document.getElementById("guru_rashi").textContent=p.guru_rashi || "--";

  /* DIN VISHESH */
  if(p.din_vishesh){
    const dv=document.getElementById("din_vishesh");
    dv.textContent="‡§¶‡§ø‡§®‡§µ‡§ø‡§∂‡•á‡§∑: "+p.din_vishesh;
    dv.style.display="block";
  }
}


/* -------- USER INPUT -------- */

const userFile=document.getElementById("userFile");
const preview=document.getElementById("preview");

userFile.addEventListener("change",e=>{
  const f=e.target.files[0];
  if(!f) return;
  const r=new FileReader();
  r.onload=()=>{
    preview.src=r.result;
    preview.style.display="block";
    document.getElementById("footer_img").src=r.result;
    document.getElementById("footer_img").style.display="block";
  };
  r.readAsDataURL(f);
});

document.getElementById("applyBtn").addEventListener("click",()=>{
  const name=document.getElementById("inpName").value.trim();
  const office=document.getElementById("inpOffice").value.trim();
  const addr=document.getElementById("inpAddress").value.trim();
  const contact=document.getElementById("inpContact").value.trim();

  if(name) document.getElementById("footer_name").textContent=name;
  if(office) document.getElementById("footer_office").textContent=office;
  if(addr) document.getElementById("footer_address").textContent=addr;
  if(contact) document.getElementById("footer_contact").textContent="‡§∏‡§Ç‡§™‡§∞‡•ç‡§ï: "+contact;

  const btn=document.getElementById("applyBtn");
  btn.textContent="‡§≤‡§æ‡§ó‡•Ç ‡§ù‡§æ‡§≤‡•á ‚úì";
  setTimeout(()=>btn.textContent="‚úî ‡§≤‡§æ‡§ó‡•Ç ‡§ï‡§∞‡§æ",1200);
});


/* -------- DOWNLOAD PNG -------- */

async function generatePNG(){
  const el=document.getElementById("panchangCard");
  await new Promise(res=>setTimeout(res,200));

  return html2canvas(el,{
    scale:1,
    useCORS:true,
    allowTaint:true,
    backgroundColor:"#ffffff"
  });
}

document.getElementById("downloadFab").addEventListener("click",async()=>{
  const canvas=await generatePNG();
  canvas.toBlob(blob=>{
    const url=URL.createObjectURL(blob);
    const a=document.createElement("a");
    a.href=url;
    a.download="panchang.png";
    a.click();
    URL.revokeObjectURL(url);
  });
});


/* INIT */
window.addEventListener("load",populatePanchang);
</script>

</body>
</html>
