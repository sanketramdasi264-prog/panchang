<!doctype html>
<html lang="mr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>‡§Ü‡§ú‡§ö‡•á ‡§™‡§Ç‡§ö‡§æ‡§Ç‡§ó ‚Äî OmKarmyog</title>

<link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@700;800&family=Noto+Sans+Devanagari:wght@400;600;700;900&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

<style>
  :root{
    --max-w:1080px;
    --cream:#fff9f1;
    --maroon:#4e0f0f;
    --gold:#ffd54a;
    --accent:#c62828;
    --blue1:#1565c0;
    --blue2:#0d47a1;
    --muted:#6b6b6b;
  }

  *{box-sizing:border-box;margin:0;padding:0}
  html,body{height:100%}
  body{
    font-family:'Noto Sans Devanagari',sans-serif;
    background:linear-gradient(180deg,#f3f7f3,#e9f0ef);
    display:flex;
    justify-content:center;
    padding:16px;
  }

  .page{width:100%;max-width:var(--max-w);}

  /* INPUT PANEL (on top) */
  .input-panel{
    background:#fff;border-radius:12px;padding:14px;margin-bottom:14px;
    box-shadow:0 10px 30px rgba(0,0,0,.08);
  }
  .ipt-row{display:flex;gap:12px;flex-wrap:wrap;align-items:flex-start}
  .ipt-col{flex:1;min-width:180px}
  .ipt-col.small{flex:0 0 180px}
  label{display:block;font-weight:700;margin-bottom:6px}
  input[type="text"], input[type="tel"], textarea, input[type="file"]{
    width:100%;padding:10px;border:2px solid #eee;border-radius:8px;font-size:15px;background:#fff;
  }
  textarea{resize:vertical;min-height:72px}
  .btn-apply{background:linear-gradient(135deg,var(--accent),#a62121);color:#fff;border:0;padding:12px 14px;border-radius:10px;font-weight:900;cursor:pointer}
  .note{font-size:12px;color:var(--muted);margin-top:6px}

  /* CARD */
  .card-wrap{display:flex;justify-content:center}
  #panchangCard{
    width:100%;
    max-width:var(--max-w);
    background:var(--cream);
    border-radius:12px;
    overflow:hidden;
    box-shadow:0 30px 60px rgba(0,0,0,0.18);
    display:flex;
    flex-direction:column;
  }

  /* header */
  .top-header{display:flex;align-items:flex-start;justify-content:space-between;padding:20px 28px;background:#fff;border-bottom:6px solid var(--gold);position:relative}
  .left-info{max-width:42%}
  .title{font-family:'Baloo 2';font-size:34px;font-weight:800;color:#0b2b3a}
  .date{font-size:22px;font-weight:900;color:var(--accent);margin-top:8px}
  .day{font-size:18px;font-weight:700;color:var(--accent);margin-top:6px}
  .ganesh-center{position:absolute;left:50%;transform:translateX(-50%);top:6px;width:220px;height:220px;display:flex;align-items:center;justify-content:center;pointer-events:none}
  .ganesh-center img{width:100%;height:100%;object-fit:contain;filter:drop-shadow(0 8px 20px rgba(0,0,0,.35))}
  .logo-right{width:140px;display:flex;align-items:flex-start;justify-content:flex-end}
  .logo-right img{max-width:140px;height:auto;object-fit:contain;display:block}

  /* shalivahan area */
  .shalivahan{background:linear-gradient(180deg,var(--accent),#a61c1c);color:#fff;text-align:center;padding:18px 16px;border-bottom:6px solid var(--gold)}
  .shalivahan h3{font-family:'Baloo 2';font-size:28px;margin-bottom:6px;font-weight:900}
  .shalivahan p{font-size:20px;margin:0;opacity:0.95;font-weight:700}

  /* sun row */
  .sun-row{display:flex;justify-content:center;gap:12px;padding:14px;background:linear-gradient(90deg,var(--blue1),var(--blue2));border-bottom:6px solid var(--gold)}
  .sun-box{display:flex;align-items:center;gap:12px;padding:10px 18px;border-radius:40px;background:rgba(255,255,255,0.08)}
  .sun-icon{width:56px;height:56px;background:#fff;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:28px;box-shadow:0 6px 16px rgba(0,0,0,.22)}
  .sun-data h4{color:#fff;margin:0;font-size:14px;font-weight:700}
  .sun-data .time{color:var(--gold);font-size:24px;font-weight:900;margin-top:4px}

  /* panchang table - simpler and responsive */
  .table-section{padding:16px 18px;background:linear-gradient(180deg,#fffdf6,#ffffff)}
  .p-table{width:100%;border-collapse:collapse;font-weight:700}
  .p-table td{padding:12px 10px;border-bottom:1px dashed #f1d7b2;vertical-align:middle}
  .p-table td.event{width:20%;color:var(--muted);text-align:left;padding-left:12px;font-size:16px}
  .p-table td.info{width:45%;text-align:left;padding-left:12px;font-size:18px}
  .p-table td.time{width:20%;text-align:center;color:var(--accent);font-weight:900}
  .p-table td.next{width:15%;text-align:center;color:#444;font-weight:700}

  /* rashi boxes */
  .rashi-section{display:flex;gap:12px;padding:16px;background:#fff;justify-content:space-between}
  .rashi-card{flex:1;background:#fff;border:3px solid #ffb300;border-radius:10px;padding:14px;text-align:center;box-shadow:0 10px 24px rgba(0,0,0,.06)}
  .rashi-card .icon{font-size:28px}
  .rashi-card .label{color:#666;font-size:14px}
  .rashi-card .val{font-size:18px;color:var(--accent);font-weight:900;margin-top:6px}

  /* din vishesh */
  .din-box{margin:12px 18px;padding:12px 14px;background:linear-gradient(180deg,#fff8e6,#fff2d9);border:2px solid #e2a92f;border-radius:8px;font-weight:800;color:var(--dark);display:none}

  /* footer */
  .footer{display:flex;align-items:center;justify-content:space-between;padding:18px;border-top:6px solid var(--gold);background:linear-gradient(90deg,var(--maroon),#4b0d0d);color:#fff}
  .footer-left{flex:1}
  .footer-left .name{font-family:'Baloo 2';font-size:26px;color:var(--gold);font-weight:900}
  .footer-left .office{font-size:18px;margin-top:6px}
  .footer-left .contact{font-size:18px;margin-top:6px}
  .footer-left .address{font-size:16px;margin-top:6px;opacity:0.95}
  .footer-photo{width:220px;height:280px;border-radius:12px;border:6px solid var(--gold);object-fit:cover;display:none;box-shadow:0 12px 30px rgba(0,0,0,.28)}

  /* download floating button */
  .download-fab{position:fixed;right:18px;bottom:18px;z-index:9999;background:linear-gradient(135deg,var(--accent),#9c2020);color:#fff;border:0;padding:12px 18px;border-radius:10px;font-weight:900;box-shadow:0 12px 30px rgba(0,0,0,.25);cursor:pointer}

  /* Responsive adjustments */
  @media (max-width:1000px){
    .left-info{max-width:38%}
    .ganesh-center{width:200px;height:200px;top:10px}
    .logo-right img{max-width:120px}
    .footer-photo{width:180px;height:240px}
  }
  @media (max-width:720px){
    body{padding:10px}
    .input-panel{padding:12px}
    .top-header{padding:14px}
    .title{font-size:20px}
    .date{font-size:16px}
    .day{font-size:14px}
    .ganesh-center{width:140px;height:140px;top:6px}
    .shalivahan h3{font-size:20px}
    .shalivahan p{font-size:16px}
    .sun-data .time{font-size:20px}
    .p-table td{font-size:14px;padding:10px}
    .rashi-card .val{font-size:16px}
    .footer-left .name{font-size:20px}
    .footer-photo{width:140px;height:180px}
    .footer{padding:12px}
  }
  @media (max-width:420px){
    .left-info{max-width:50%}
    .ganesh-center{width:120px;height:120px}
    .logo-right img{max-width:90px}
  }
</style>
</head>
<body>
  <div class="page">

    <!-- INPUT PANEL (top) -->
    <div class="input-panel" role="region" aria-label="User info">
      <div style="display:flex;gap:12px;flex-wrap:wrap;align-items:flex-start">
        <div style="flex:0 0 140px">
          <label>üì∏ ‡§´‡•ã‡§ü‡•ã</label>
          <input id="userFile" type="file" accept="image/*">
          <img id="preview" alt="preview" style="width:120px;height:120px;object-fit:cover;border-radius:8px;margin-top:8px;display:none;border:3px solid var(--accent)">
        </div>

        <div style="flex:1;min-width:220px">
          <label>üë§ ‡§Ü‡§™‡§≤‡•á ‡§®‡§æ‡§µ</label>
          <input id="inpName" type="text" placeholder="‡§§‡•Å‡§Æ‡§ö‡•á ‡§®‡§æ‡§µ" />

          <label style="margin-top:8px">üè¢ ‡§ï‡§æ‡§∞‡•ç‡§Ø‡§æ‡§≤‡§Ø</label>
          <input id="inpOffice" type="text" placeholder="‡§ï‡§æ‡§∞‡•ç‡§Ø‡§æ‡§≤‡§Ø / ‡§µ‡•ç‡§Ø‡§µ‡§∏‡§æ‡§Ø" />
        </div>

        <div style="flex:0 0 180px">
          <label>üì± ‡§∏‡§Ç‡§™‡§∞‡•ç‡§ï</label>
          <input id="inpContact" type="tel" placeholder="‡§Æ‡•ã‡§¨‡§æ‡§à‡§≤" />

          <label style="margin-top:8px">üìç ‡§™‡§§‡•ç‡§§‡§æ</label>
          <input id="inpAddress" type="text" placeholder="‡§™‡§§‡•ç‡§§‡§æ (‡§™‡§∞‡•ç‡§Ø‡§æ‡§Ø‡•Ä)" />
        </div>

        <div style="flex:0 0 140px;display:flex;flex-direction:column;gap:8px;justify-content:flex-end">
          <button class="btn-apply" id="applyBtn">‚úî ‡§≤‡§æ‡§ó‡•Ç ‡§ï‡§∞‡§æ</button>
          <div class="note">Admin: panchang.json ‡§´‡§æ‡§à‡§≤ repo root ‡§Æ‡§ß‡•ç‡§Ø‡•á ‡§†‡•á‡§µ‡§æ</div>
        </div>
      </div>
    </div>

    <!-- CARD -->
    <div class="card-wrap">
      <div id="panchangCard" role="main" aria-label="Panchang card">

        <!-- HEADER -->
        <div class="top-header">
          <div class="left-info">
            <div class="title">‡§Ü‡§ú‡§ö‡•á ‡§™‡§Ç‡§ö‡§æ‡§Ç‡§ó</div>
            <div class="date" id="hdrDate">--</div>
            <div class="day" id="hdrDay">--</div>
          </div>

          <div class="ganesh-center" aria-hidden="true">
            <img id="ganesh" crossorigin="anonymous" src="https://raw.githubusercontent.com/sanketramdasi264-prog/panchang/main/pngtree-artistic-vinayaka-chavithi-celebrations-for-ganesh-chaturthi-bal-free-transparent-png-image_14089909.png" alt="Ganesh">
          </div>

          <div class="logo-right">
            <img id="logo" crossorigin="anonymous" src="https://blogger.googleusercontent.com/img/a/AVvXsEghUXDnRLeFXsuapWEpRem_Mtzst5Ae9zlttWprP9nI7dQ_Rh41nkHP3PqCiHrZo1YKUiMvbHaPZC6VZEBCSvuAvzQOVF7MxUon4i3Hdko0qGWwyl4BQ44KeAe-6qQACSUB8k-3wdI6N2Bt-8xsQSQnHW-a2AMw9SwT0hK4b5Ej5zmN_anbnY1pX2TC9pwR=s500" alt="Logo">
          </div>
        </div>

        <!-- SHALIVAHAN -->
        <div class="shalivahan">
          <h3 id="shalivahanLine">‡§∂‡§æ‡§≤‡§ø‡§µ‡§æ‡§π‡§® ‡§∂‡§ï‡•á ‡•ß‡•Ø‡•™‡•≠</h3>
          <p id="shalivahanMeta">‡§µ‡§ø‡§∂‡•ç‡§µ‡§æ‡§µ‡§∏‡•Å ‡§®‡§æ‡§Æ ‡§∏‡§Ç‡§µ‡§§‡•ç‡§∏‡§∞, ‡§¶‡§ï‡•ç‡§∑‡§ø‡§£‡§æ‡§Ø‡§®, ‡§∂‡§∞‡§¶‡§ã‡§§‡•Ç, ‡§ï‡§æ‡§∞‡•ç‡§§‡§ø‡§ï ‡§Æ‡§æ‡§∏, ‡§ï‡•É‡§∑‡•ç‡§£ ‡§™‡§ï‡•ç‡§∑</p>
        </div>

        <!-- SUN -->
        <div class="sun-row" role="region" aria-label="Sunrise sunset">
          <div class="sun-box">
            <div class="sun-icon">üåÖ</div>
            <div class="sun-data"><h4>‡§∏‡•Ç‡§∞‡•ç‡§Ø‡•ã‡§¶‡§Ø</h4><div id="sunrise" class="time">--</div></div>
          </div>
          <div class="sun-box">
            <div class="sun-icon">üåÑ</div>
            <div class="sun-data"><h4>‡§∏‡•Ç‡§∞‡•ç‡§Ø‡§æ‡§∏‡•ç‡§§</h4><div id="sunset" class="time">--</div></div>
          </div>
        </div>

        <!-- TABLE -->
        <div class="table-section" role="table" aria-label="Panchang details">
          <table class="p-table" aria-hidden="false">
            <tbody>
              <tr>
                <td class="event">‡§§‡§ø‡§•‡•Ä</td>
                <td class="info" id="tithi">--</td>
                <td class="time" id="tithi_end">--</td>
                <td class="next" id="tithi_next">--</td>
              </tr>

              <tr>
                <td class="event">‡§µ‡§æ‡§∞</td>
                <td class="info" id="vaar">--</td>
                <td class="time" id="vaar_time">--</td>
                <td class="next" id="vaar_sanskrit">--</td>
              </tr>

              <tr>
                <td class="event">‡§®‡§ï‡•ç‡§∑‡§§‡•ç‡§∞</td>
                <td class="info" id="nak">--</td>
                <td class="time" id="nak_end">--</td>
                <td class="next" id="nak_next">--</td>
              </tr>

              <tr>
                <td class="event">‡§Ø‡•ã‡§ó</td>
                <td class="info" id="yog">--</td>
                <td class="time" id="yog_time">--</td>
                <td class="next" id="yog_next">--</td>
              </tr>

              <tr>
                <td class="event">‡§ï‡§∞‡§£</td>
                <td class="info" id="kar">--</td>
                <td class="time" id="kar_end">--</td>
                <td class="next" id="kar_next">--</td>
              </tr>
            </tbody>
          </table>
        </div>

        <!-- RASHI -->
        <div class="rashi-section" role="region" aria-label="Rashis">
          <div class="rashi-card"><div class="icon">üåô</div><div class="label">‡§ö‡§Ç‡§¶‡•ç‡§∞‡§∞‡§æ‡§∂‡•Ä</div><div class="val" id="moon_rashi">--</div></div>
          <div class="rashi-card"><div class="icon">‚òÄÔ∏è</div><div class="label">‡§∏‡•Ç‡§∞‡•ç‡§Ø‡§∞‡§æ‡§∂‡•Ä</div><div class="val" id="sun_rashi">--</div></div>
          <div class="rashi-card"><div class="icon">üîÜ</div><div class="label">‡§ó‡•Å‡§∞‡•Å‡§∞‡§æ‡§∂‡•Ä</div><div class="val" id="guru_rashi">--</div></div>
        </div>

        <!-- DIN VISHESH -->
        <div id="din_vishesh" class="din-box"></div>

        <!-- FOOTER -->
        <div class="footer" role="contentinfo">
          <div class="footer-left">
            <div class="name" id="footer_name">‡§Ü‡§™‡§≤‡•á ‡§®‡§æ‡§µ</div>
            <div class="office" id="footer_office"></div>
            <div class="contact" id="footer_contact"></div>
            <div class="address" id="footer_address"></div>
          </div>
          <div style="width:240px;display:flex;align-items:center;justify-content:center">
            <img id="footer_img" class="footer-photo" alt="User photo">
          </div>
        </div>

      </div>
    </div>

    <!-- Floating download -->
    <button class="download-fab" id="downloadFab">Download PNG</button>

  </div>

<script>
/* CONFIG: local JSON and fallback (github raw) */
const LOCAL_JSON = './panchang.json';
const FALLBACK_JSON = 'https://sanketramdasi264-prog.github.io/panchang/panchang.json';

const daysMR = ['‡§∞‡§µ‡§ø‡§µ‡§æ‡§∞','‡§∏‡•ã‡§Æ‡§µ‡§æ‡§∞','‡§Æ‡§Ç‡§ó‡§≥‡§µ‡§æ‡§∞','‡§¨‡•Å‡§ß‡§µ‡§æ‡§∞','‡§ó‡•Å‡§∞‡•Å‡§µ‡§æ‡§∞','‡§∂‡•Å‡§ï‡•ç‡§∞‡§µ‡§æ‡§∞','‡§∂‡§®‡§ø‡§µ‡§æ‡§∞'];
function todayISO(){ const d=new Date(); return `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}-${String(d.getDate()).padStart(2,'0')}` }
function fmtDate(d=new Date()){ return `${String(d.getDate()).padStart(2,'0')}-${String(d.getMonth()+1).padStart(2,'0')}-${d.getFullYear()}` }

/* Try fetch local, then fallback */
async function fetchPanchangJson(){
  try {
    const r = await fetch(LOCAL_JSON, {cache:'no-store'});
    if (r.ok) return await r.json();
  } catch(e){}
  try {
    const r2 = await fetch(FALLBACK_JSON, {cache:'no-store'});
    if (r2.ok) return await r2.json();
  } catch(e){}
  return null;
}

/* populate UI */
async function populatePanchang(){
  const data = await fetchPanchangJson();
  const key = todayISO();
  const now = new Date();
  document.getElementById('hdrDate').textContent = fmtDate(now);
  document.getElementById('hdrDay').textContent = daysMR[now.getDay()];

  if(!data || !data[key]){
    // no data
    console.warn('panchang missing for', key);
    // clear fields
    ['tithi','tithi_end','tithi_next','vaar','vaar_time','vaar_sanskrit','nak','nak_end','nak_next','yog','yog_time','yog_next','kar','kar_end','kar_next','sunrise','sunset','moon_rashi','sun_rashi','guru_rashi','din_vishesh'].forEach(id=>{
      const el = document.getElementById(id) || document.getElementById(id.replace(/_/g,''));
      if(el) el.textContent = '--';
    });
    document.getElementById('din_vishesh').style.display = 'none';
    return;
  }

  const p = data[key];

  // shalivahan
  if(p.shalivahan) document.getElementById('shalivahanLine').textContent = p.shalivahan;
  if(p.shalivahan_meta) document.getElementById('shalivahanMeta').textContent = p.shalivahan_meta;

  // sunrise/sunset
  document.getElementById('sunrise').textContent = p.sunrise || '--';
  document.getElementById('sunset').textContent = p.sunset || '--';

  // helper endings
  const endP = v => v ? (v + ' ‡§™') : '--';
  const nextN = v => v ? ('‡§®‡§Ç ‚Äî ' + v) : '--';

  // tithi
  document.getElementById('tithi').textContent = p.tithi || '--';
  document.getElementById('tithi_end').textContent = endP(p.tithi_end || p.tithi_end_raw || p.tithi_end_time);
  document.getElementById('tithi_next').textContent = nextN(p.tithi_next || p.tithiNext || p.next_tithi);

  // vaar
  document.getElementById('vaar').textContent = p.vaar || daysMR[now.getDay()];
  document.getElementById('vaar_time').textContent = p.vaar_time || '--';
  document.getElementById('vaar_sanskrit').textContent = p.vaar_sanskrit || p.vaarSanskrit || '--';

  // nakshatra
  document.getElementById('nak').textContent = p.nakshatra || '--';
  document.getElementById('nak_end').textContent = endP(p.nakshatra_end || p.nak_end);
  document.getElementById('nak_next').textContent = nextN(p.nakshatra_next || p.nak_next);

  // yoga
  document.getElementById('yog').textContent = p.yog || '--';
  document.getElementById('yog_time').textContent = p.yog_time || p.yogTime || '--';
  document.getElementById('yog_next').textContent = nextN(p.yog_next || p.yogNext);

  // karan
  document.getElementById('kar').textContent = p.karan || p.karana || '--';
  document.getElementById('kar_end').textContent = endP(p.karan_end || p.karan_end_raw);
  document.getElementById('kar_next').textContent = nextN(p.karan_next || p.karanNext);

  // rashis
  document.getElementById('moon_rashi').textContent = p.moon_rashi || p.moonRashi || '--';
  document.getElementById('sun_rashi').textContent = p.sun_rashi || p.sunRashi || '--';
  document.getElementById('guru_rashi').textContent = p.guru_rashi || p.guruRashi || '--';

  // din vishesh
  if(p.din_vishesh){
    const dv = document.getElementById('din_vishesh');
    dv.textContent = '‡§¶‡§ø‡§®‡§µ‡§ø‡§∂‡•á‡§∑: ' + p.din_vishesh;
    dv.style.display = 'block';
  } else {
    document.getElementById('din_vishesh').style.display = 'none';
  }
}

/* USER INPUT -> footer */
const preview = document.getElementById('preview');
const userFile = document.getElementById('userFile');
userFile.addEventListener('change', e=>{
  const f = e.target.files[0];
  if(!f) return;
  const r = new FileReader();
  r.onload = ()=> {
    preview.src = r.result; preview.style.display = 'block';
    document.getElementById('footer_img').src = r.result; document.getElementById('footer_img').style.display = 'block';
  };
  r.readAsDataURL(f);
});

document.getElementById('applyBtn').addEventListener('click', ()=>{
  const name = document.getElementById('inpName').value.trim();
  const office = document.getElementById('inpOffice').value.trim();
  const contact = document.getElementById('inpContact').value.trim();
  const addr = document.getElementById('inpAddress').value.trim();

  if(name) document.getElementById('footer_name').textContent = name;
  if(office) document.getElementById('footer_office').textContent = office;
  if(contact) document.getElementById('footer_contact').textContent = '‡§∏‡§Ç‡§™‡§∞‡•ç‡§ï: ' + contact;
  if(addr) document.getElementById('footer_address').textContent = '‡§™‡§§‡•ç‡§§‡§æ: ' + addr;

  // small visual feedback
  const btn = document.getElementById('applyBtn');
  btn.textContent = '‡§≤‡§æ‡§ó‡•Ç ‡§ù‡§æ‡§≤‡•á ‚úì';
  setTimeout(()=> btn.textContent = '‚úî ‡§≤‡§æ‡§ó‡•Ç ‡§ï‡§∞‡§æ', 1200);
});

/* DOWNLOAD ‚Äî ensure images load with crossOrigin and wait */
const logoImg = document.getElementById('logo');
const ganeshImg = document.getElementById('ganesh');
[logoImg, ganeshImg, document.getElementById('footer_img')].forEach(img => {
  try{ img.crossOrigin = 'anonymous'; }catch(e){}
});

async function waitForImages(){
  const imgs = [logoImg, ganeshImg, document.getElementById('footer_img')];
  const promises = imgs.map(im=>{
    return new Promise(r=>{
      if(!im || !im.src) return r();
      if(im.complete && im.naturalHeight!==0) return r();
      im.onload = ()=> r(); im.onerror = ()=> r();
    });
  });
  return Promise.all(promises);
}

async function generatePNG(){
  // apply info in case not applied
  document.getElementById('applyBtn').click();
  await waitForImages();
  const el = document.getElementById('panchangCard');
  // small delay to ensure fonts render
  await new Promise(res => setTimeout(res, 220));
  return html2canvas(el, {scale:2, useCORS:true, allowTaint:false, backgroundColor:'#ffffff'});
}

document.getElementById('downloadFab').addEventListener('click', async ()=>{
  try{
    const canvas = await generatePNG();
    canvas.toBlob(blob=>{
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      const name = (document.getElementById('inpName').value || 'panchang').replace(/\s+/g,'_');
      const d = new Date();
      a.download = `panchang_${d.getFullYear()}${String(d.getMonth()+1).padStart(2,'0')}${String(d.getDate()).padStart(2,'0')}_${name}.png`;
      a.href = url; document.body.appendChild(a); a.click(); a.remove();
      setTimeout(()=> URL.revokeObjectURL(url), 500);
    }, 'image/png');
  }catch(err){
    console.error(err);
    alert('Download ‡§Æ‡§ß‡•ç‡§Ø‡•á ‡§Ö‡§°‡§ö‡§£ ‡§Ü‡§≤‡•Ä ‚Äî console ‡§§‡§™‡§æ‡§∏‡§æ.');
  }
});

/* INIT */
window.addEventListener('load', async ()=>{
  // Set date header
  const now = new Date();
  document.getElementById('hdrDate').textContent = `${String(now.getDate()).padStart(2,'0')}-${String(now.getMonth()+1).padStart(2,'0')}-${now.getFullYear()}`;
  document.getElementById('hdrDay').textContent = daysMR[now.getDay()];

  // try to load panchang
  await populatePanchang();
});
</script>
</body>
</html>
