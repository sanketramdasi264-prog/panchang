<!doctype html>
<html lang="mr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>OmKarmyog — आजचा पंचांग (Premium)</title>

<link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@700&family=Noto+Sans+Devanagari:wght@400;600;700&display=swap" rel="stylesheet">

<style>
:root{
  --canvas-w:1080px;
  --canvas-h:1316px;
  --cream:#fffaf3;
  --navy:#08324a;
  --saffron:#c86d22;
  --gold:#b8860b;
  --maroon:#5a1f18;
  --muted:#6b6b6b;
}
*{box-sizing:border-box}
body{
  margin:0;
  background:#f4f4f6;
  font-family:'Noto Sans Devanagari',sans-serif;
  color:#0b2b3a;
  padding:20px;
}
.container{
  max-width:980px;
  margin:14px auto;
  background:#fff;
  border-radius:12px;
  padding:18px;
  box-shadow:0 12px 28px rgba(0,0,0,.08);
}
.header-title{
  font-family:'Baloo 2';
  font-size:20px;
  margin:0 0 6px;
}
.hint{font-size:13px;color:var(--muted);margin-bottom:12px}
label{display:block;margin-top:10px;font-weight:600}
input,textarea{width:100%;padding:10px;border-radius:8px;border:1px solid #e3e3e3;margin-top:8px;font-size:15px}
textarea{min-height:60px}
.controls{display:flex;gap:10px;margin-top:12px}
button{border:0;padding:12px;border-radius:8px;cursor:pointer;color:#fff;font-weight:700}
.generate{background:var(--navy);flex:1}
.download{background:var(--saffron);flex:1}
#preview{display:block;margin-top:14px;width:100%;border-radius:8px;border:1px solid #eee}
.small{font-size:13px;color:var(--muted);margin-top:8px}
@media(max-width:720px){ .controls{flex-direction:column} .container{padding:12px} }
.note{font-size:12px;color:#777;margin-top:10px}
</style>
</head>
<body>
  <div class="container">
    <h1 class="header-title">आजचा पंचांग — OmKarmyog (Premium)</h1>
    <div class="hint">Premium devotional card — Ganpati top-center, saffron-bordered table, maroon textured footer. Card size: <strong>1080 × 1316</strong>.  Generate → Download.</div>

    <label>आपले नाव</label>
    <input id="username" placeholder="__________ गुरुजी">

    <label>कार्यालय माहिती (ऐच्छिक)</label>
    <input id="office" placeholder="उदा. ज्योतिष्य कार्यालय, पुणे">

    <label>संपर्क</label>
    <input id="mobile" placeholder="उदा. 98XXXXXXXX">

    <label>फोटो (ऐच्छिक) — square preferred (will be cropped)</label>
    <input id="photo" type="file" accept="image/*">

    <div class="controls">
      <button id="generateBtn" class="generate">Generate Card</button>
      <button id="downloadBtn" class="download">Download PNG</button>
    </div>

    <canvas id="canvas" width="1080" height="1316" style="display:none"></canvas>
    <img id="preview" alt="Preview (1080×1316)" />

    <div class="note">Admin: update <code>panchang.json</code> in repo root (YYYY-MM-DD). Images used: <code>1000894411.png</code> (logo) and your uploaded Ganpati PNG. If preview blank — check console for errors.</div>
  </div>

<script>
/* ====== CONFIG ====== */
// Your repo-hosted files (already uploaded)
const GANPATI_RAW = 'https://raw.githubusercontent.com/sanketramdasi264-prog/panchang/main/pngtree-artistic-vinayaka-chavithi-celebrations-for-ganesh-chaturthi-bal-free-transparent-png-image_14089909.png';
const LOGO_LOCAL = './1000894411.png'; // uploaded logo in repo
const PUNCH_JSON = './panchang.json';   // panchang data (admin updates)
const CANVAS_W = 1080, CANVAS_H = 1316;

/* ====== DOM ====== */
const el = id => document.getElementById(id);
let userPhotoData = null;
el('photo').addEventListener('change', e=>{
  const f = e.target.files[0];
  if(!f){ userPhotoData = null; return; }
  const r = new FileReader();
  r.onload = ()=> userPhotoData = r.result;
  r.readAsDataURL(f);
});

/* ====== UTIL ====== */
function todayISO(){ const d=new Date(); const y=d.getFullYear(), m=('0'+(d.getMonth()+1)).slice(-2), dd=('0'+d.getDate()).slice(-2); return `${y}-${m}-${dd}`;}
function wrapText(ctx, text, x, y, maxW, lineH){
  const words = String(text).split(' ');
  let line = '';
  for(let n=0;n<words.length;n++){
    const test = line + words[n] + ' ';
    if(ctx.measureText(test).width > maxW && n>0){
      ctx.fillText(line, x, y);
      line = words[n] + ' ';
      y += lineH;
    } else { line = test; }
  }
  ctx.fillText(line, x, y);
}

/* ====== LOAD JSON ====== */
async function loadPanchang(){
  const res = await fetch(PUNCH_JSON, {cache:'no-store'});
  if(!res.ok) throw new Error('panchang.json fetch failed: '+res.status);
  return await res.json();
}

/* ====== DRAW HELPERS ====== */
function roundRectPath(ctx,x,y,w,h,r){ ctx.beginPath(); ctx.moveTo(x+r,y); ctx.arcTo(x+w,y,x+w,y+h,r); ctx.arcTo(x+w,y+h,x,y+h,r); ctx.arcTo(x,y+h,x,y,r); ctx.arcTo(x,y,x+w,y,r); ctx.closePath(); }
function roundRectFill(ctx,x,y,w,h,r,color){ ctx.save(); ctx.fillStyle=color; roundRectPath(ctx,x,y,w,h,r); ctx.fill(); ctx.restore(); }
function roundRectStroke(ctx,x,y,w,h,r,strokeStyle,lineWidth){ ctx.save(); ctx.strokeStyle=strokeStyle; ctx.lineWidth=lineWidth||1; roundRectPath(ctx,x,y,w,h,r); ctx.stroke(); ctx.restore(); }
function drawIcon(ctx,x,y,glyph){ ctx.save(); ctx.fillStyle='#f9c846'; ctx.beginPath(); ctx.arc(x,y,26,0,Math.PI*2); ctx.fill(); ctx.fillStyle='#fff'; ctx.font='18px Noto Sans Devanagari'; ctx.textAlign='center'; ctx.textBaseline='middle'; ctx.fillText(glyph,x,y); ctx.restore(); }

/* ====== MAIN DRAW ====== */
async function drawCard(){
  const canvas = el('canvas'); const ctx = canvas.getContext('2d');
  // fetch panchang data
  let p;
  try{
    const json = await loadPanchang();
    p = json[todayISO()];
    if(!p) throw new Error('आजची entry panchang.json मध्ये नाही: ' + todayISO());
  }catch(err){
    alert('Panchang load error: ' + err.message + '\n\nकृपया panchang.json मध्ये आजची तारीख जोडा (format YYYY-MM-DD).');
    throw err;
  }

  // clear canvas
  ctx.fillStyle = '#fffaf3';
  ctx.fillRect(0,0,CANVAS_W,CANVAS_H);

  // top decorative gradient band
  const grad = ctx.createLinearGradient(0,0,0,120);
  grad.addColorStop(0, '#06314a');
  grad.addColorStop(1, '#08324a');
  ctx.fillStyle = grad; ctx.fillRect(0,0,CANVAS_W,120);

  // top-center ganpati image (big)
  try{
    const gp = new Image(); gp.crossOrigin='anonymous'; gp.src = GANPATI_RAW;
    await new Promise((res,rej)=>{ gp.onload=res; gp.onerror=rej; });
    // scale to about 280-320 px height
    const targetH = 260;
    const sc = targetH / gp.height;
    const w = gp.width * sc;
    const h = gp.height * sc;
    ctx.drawImage(gp, CANVAS_W/2 - w/2, 40 - 60, w, h); // draw slightly above header to create centered devotional look
  }catch(e){
    // ignore if failed
    console.warn('Ganpati image failed', e);
  }

  // header text "आजचे पंचांग" left small and date right
  ctx.fillStyle = '#fff';
  ctx.font = 'bold 42px Baloo 2';
  ctx.textAlign = 'left'; ctx.textBaseline = 'middle';
  ctx.fillText('आजचे पंचांग', 48, 60);

  // date right
  ctx.font = '18px Noto Sans Devanagari';
  try{
    const d = new Date();
    const dt = d.toLocaleDateString('mr-IN',{weekday:'long', day:'numeric', month:'long', year:'numeric'});
    ctx.textAlign='right'; ctx.fillText(dt, CANVAS_W - 48, 60);
  }catch(e){
    ctx.textAlign='right'; ctx.fillText(todayISO(), CANVAS_W - 48, 60);
  }

  // subtle sunburst / watermark behind table (very faint)
  ctx.save(); ctx.globalAlpha = 0.06;
  ctx.fillStyle = '#dba84a';
  ctx.beginPath();
  ctx.ellipse(CANVAS_W/2, 420, 420, 170, 0, 0, Math.PI*2);
  ctx.fill();
  ctx.restore();

  // main table card
  const boxX = 48, boxY = 150, boxW = CANVAS_W - 96, boxH = 520;
  roundRectStroke(ctx, boxX, boxY, boxW, boxH, 14, '#c86d22', 6);

  // left icons column and text column
  ctx.fillStyle = '#0b2b3a';
  ctx.textAlign = 'left';
  ctx.font = '28px Noto Sans Devanagari';
  let y = boxY + 70;
  const gap = 62;
  const textX = boxX + 110;

  drawIcon(ctx, boxX+48, y-8, 'ति');
  ctx.fillText(`तिथी: ${p.tithi || ''}${p.tithi_end ? ' • समाप्ती: ' + p.tithi_end : ''}`, textX, y);
  y += gap;

  drawIcon(ctx, boxX+48, y-8, 'वा');
  ctx.fillText(`वार: ${new Date().toLocaleDateString('mr-IN',{weekday:'long'})}`, textX, y);
  y += gap;

  drawIcon(ctx, boxX+48, y-8, 'न');
  ctx.fillText(`नक्षत्र: ${p.nakshatra || ''}${p.nakshatra_end ? ' • समाप्ती: ' + p.nakshatra_end : ''}`, textX, y);
  y += gap;

  drawIcon(ctx, boxX+48, y-8, 'यो');
  ctx.fillText(`योग: ${p.yog || ''}`, textX, y);
  y += gap;

  drawIcon(ctx, boxX+48, y-8, 'क');
  ctx.fillText(`करण: ${p.karan || ''}${p.karan_end ? ' • समाप्ती: ' + p.karan_end : ''}`, textX, y);

  // right column (sunrise/sunset/rashi/rahu etc)
  const col2X = boxX + Math.floor(boxW / 2) + 20;
  let y2 = boxY + 70;
  ctx.font = '26px Noto Sans Devanagari';
  ctx.fillText(`सूर्योदय: ${p.sunrise || ''}`, col2X, y2); y2 += 44;
  ctx.fillText(`सूर्यास्त: ${p.sunset || ''}`, col2X, y2); y2 += 44;
  ctx.fillText(`चंद्रराशी: ${p.moon_rashi || p.chandra_rashi || ''}`, col2X, y2); y2 += 44;
  ctx.fillText(`सूर्यराशी: ${p.sun_rashi || p.surya_rashi || ''}`, col2X, y2); y2 += 44;
  ctx.fillText(`गुरुराशी: ${p.guru_rashi || ''}`, col2X, y2); y2 += 44;
  ctx.fillText(`राहू काल: ${p.rahu || p.rahu_kal || ''}`, col2X, y2);

  // din-vishesh below table (saffron highlight)
  if(p.din_vishesh){
    const dvY = boxY + boxH + 12;
    roundRectFill(ctx, boxX, dvY, boxW, 72, 10, '#fff3cc');
    roundRectStroke(ctx, boxX, dvY, boxW, 72, 10, '#e2a92f', 2);
    ctx.fillStyle = '#0b2b3a';
    ctx.font = '22px Noto Sans Devanagari';
    wrapText(ctx, `दिनविशेष: ${p.din_vishesh}`, boxX + 18, dvY + 40, boxW - 36, 30);
  }

  // bottom maroon textured strip
  const stripY = boxY + boxH + 110;
  // subtle texture via gradient
  const g = ctx.createLinearGradient(0,stripY,0,stripY+170);
  g.addColorStop(0, '#6a1f18');
  g.addColorStop(1, '#4c1510');
  ctx.fillStyle = g;
  ctx.fillRect(0, stripY, CANVAS_W, 170);

  // gold top border for maroon strip
  ctx.fillStyle = '#d8a24f';
  ctx.fillRect(48, stripY, CANVAS_W - 96, 6);

  // left: user details (marathi bold)
  ctx.fillStyle = '#fff';
  ctx.textAlign = 'left';
  const usrName = el('username').value || '';
  const usrOffice = el('office').value || '';
  const usrMobile = el('mobile').value || '';
  ctx.font = 'bold 36px Noto Sans Devanagari';
  ctx.fillText(usrName, 56, stripY + 56);

  ctx.font = '20px Noto Sans Devanagari';
  if(usrOffice) ctx.fillText(usrOffice, 56, stripY + 96);
  ctx.fillText(`संपर्क: ${usrMobile}`, 56, stripY + 130);

  // right: user photo (square, gold border)
  const photoSize = 160;
  const px = CANVAS_W - 56 - photoSize;
  const py = stripY + 10;
  if(userPhotoData){
    try{
      const img = new Image(); img.crossOrigin='anonymous'; img.src = userPhotoData;
      await new Promise((res,rej)=>{ img.onload=res; img.onerror=rej; });
      // cover crop to square
      let sx=0, sy=0, sw=img.width, sh=img.height;
      const ratio = img.width / img.height;
      if(ratio > 1){ sw = img.height; sx = Math.floor((img.width - sw) / 2); }
      else if(ratio < 1){ sh = img.width; sy = Math.floor((img.height - sh) / 2); }

      // golden outer border
      roundRectFill(ctx, px-8, py-8, photoSize+16, photoSize+16, 14, '#b8860b');
      // inner white padding
      roundRectFill(ctx, px-5, py-5, photoSize+10, photoSize+10, 12, '#fff');
      // draw image clipped
      roundRectPath(ctx, px, py, photoSize, photoSize, 10);
      ctx.save(); ctx.clip();
      ctx.drawImage(img, sx, sy, sw, sh, px, py, photoSize, photoSize);
      ctx.restore();
    }catch(e){
      // fallback placeholder
      roundRectFill(ctx, px-8, py-8, photoSize+16, photoSize+16, 14, '#b8860b');
      roundRectFill(ctx, px-5, py-5, photoSize+10, photoSize+10, 12, '#fff');
      ctx.fillStyle = '#eaeaea'; ctx.fillRect(px, py, photoSize, photoSize);
      ctx.fillStyle = '#999'; ctx.font='16px Noto Sans Devanagari'; ctx.textAlign='center';
      ctx.fillText('आपला फोटो', px + photoSize/2, py + photoSize/2 + 6);
    }
  } else {
    // placeholder square
    roundRectFill(ctx, px-8, py-8, photoSize+16, photoSize+16, 14, '#b8860b');
    roundRectFill(ctx, px-5, py-5, photoSize+10, photoSize+10, 12, '#fff');
    ctx.fillStyle = '#eaeaea'; ctx.fillRect(px, py, photoSize, photoSize);
    ctx.fillStyle = '#999'; ctx.font='16px Noto Sans Devanagari'; ctx.textAlign='center';
    ctx.fillText('आपला फोटो', px + photoSize/2, py + photoSize/2 + 6);
  }

  // small logo bottom-right watermark (very subtle)
  try{
    const logo = new Image(); logo.crossOrigin='anonymous'; logo.src = LOGO_LOCAL;
    await new Promise((res,rej)=>{ logo.onload=res; logo.onerror=rej; });
    ctx.save(); ctx.globalAlpha = 0.12;
    const lw = 120, lh = (logo.height/logo.width)*lw;
    ctx.drawImage(logo, CANVAS_W - lw - 18, CANVAS_H - lh - 18, lw, lh);
    ctx.restore();
  }catch(e){ /* ignore */ }

  // final preview export
  el('preview').src = canvas.toDataURL('image/png');
}

/* ====== EVENTS ====== */
el('generateBtn').addEventListener('click', async ()=>{
  try{
    el('generateBtn').disabled = true;
    await drawCard();
  }catch(e){ console.error(e); }
  finally{ el('generateBtn').disabled = false; }
});

el('downloadBtn').addEventListener('click', ()=>{
  const a = document.createElement('a');
  a.href = el('canvas').toDataURL('image/png');
  a.download = `panchang_1080x1316.png`;
  a.click();
});

// auto-generate on load
window.addEventListener('load', ()=> setTimeout(()=> el('generateBtn').click(), 800));
</script>
</body>
</html>
